//- Gertrude --- GTD done right
//- Copyright © 2023 Tanguy Le Carrour <tanguy@bioneland.org>
//-
//- This program is free software: you can redistribute it and/or modify
//- it under the terms of the GNU Affero General Public License as
//- published by the Free Software Foundation, either version 3 of the
//- License, or (at your option) any later version.
//-
//- This program is distributed in the hope that it will be useful,
//- but WITHOUT ANY WARRANTY; without even the implied warranty of
//- MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
//- GNU Affero General Public License for more details.
//-
//- You should have received a copy of the GNU Affero General Public License
//- along with this program. If not, see <http://www.gnu.org/licenses/>.

extends layout

block modal
  .modal.is-active(_="on closeModal remove me")
    .modal-background(_="on click trigger closeModal then halt default")
    .modal-card
      header.modal-card-head
        p.modal-card-title= task.title
        a.delete(
          href=url_for("tasks.inbox")
          _="on click trigger closeModal then halt default"
          aria-label="close"
        )

      section.modal-card-body
        if task.description
          alert.message: .message-body: p= task.description

        dl
          if task.assigned_to
            - var project = projects_by_id[task.assigned_to]
            dt Assigned to
            dd
              a(href=url_for("projects.display", id=project.id))= project.name
          if task.delegated_to
            dt Delegated to
            dd= task.delegated_to

          h2.title.is-5 Decide what to do next

          if task.state == "captured"
            h3.title.is-6.has-text-centered Is is actionable?

            .columns
              .column
                .message.is-success.has-text-centered: .message-body: p: strong Yes
                .columns.is-mobile
                  .column: p.has-text-right If it taks less than 2 minutes…
                  .column
                    form(
                      method="POST"
                      action=url_for("tasks.do", id=task.id)
                      hx-post=url_for("tasks.do", id=task.id)
                      hx-target="#modal"
                    )
                      button.button.is-success.is-fullwidth(type="submit")
                        span.icon: i.fas.fa-thumbs-up(aria-hidden="true")
                        span Do it!
                .columns.is-mobile
                  .column: p.has-text-right If someone else can do it for you…
                  .column
                    a.button.is-info.is-fullwidth(
                      href=url_for("tasks.delegate_form", id=task.id)
                      hx-get=url_for("tasks.delegate_form", id=task.id)
                      hx-target="#modal"
                    )
                      span.icon: i.fas.fa-coffee(aria-hidden="true")
                      span Delegate it!
                .columns.is-mobile
                  .column: p.has-text-right If it requires multiples steps…
                  .column: a.button.is-info.is-fullwidth(href="#" disabled)
                    span.icon: i.fas.fa-tasks(aria-hidden="true")
                    span Make it a project!
                .columns.is-mobile
                  .column: p.has-text-right Else…
                  .column
                    form(
                      method="POST"
                      action=url_for("tasks.postpone", id=task.id)
                      hx-post=url_for("tasks.postpone", id=task.id)
                      hx-target="#modal"
                    )
                      button.button.is-success.is-fullwidth(type="submit")
                        span.icon: i.fas.fa-chevron-circle-right(aria-hidden="true")
                        span Postpone it!
              .column
                .message.is-danger.has-text-centered: .message-body: p: strong No
                .columns.is-mobile
                  .column: p.has-text-right If it is part of a project…
                  .column
                    a.button.is-info.is-fullwidth(
                      href=url_for("tasks.assign_form", id=task.id)
                      hx-get=url_for("tasks.assign_form", id=task.id)
                      hx-target="#modal"
                    )
                      span.icon: i.fas.fa-tasks(aria-hidden="true")
                      span Assign it!
                .columns.is-mobile
                  .column: p.has-text-right If it has to be done at a later time…
                  .column
                    a.button.is-info.is-fullwidth(
                      href=url_for("tasks.schedule_form", id=task.id)
                      hx-get=url_for("tasks.schedule_form", id=task.id)
                      hx-target="#modal"
                    )
                      span.icon: i.fas.fa-calendar(aria-hidden="true")
                      span Schedule it!
                .columns.is-mobile
                  .column: p.has-text-right If you want to do it someday…
                  .column
                    form(
                      method="POST"
                      action=url_for("tasks.incubate", id=task.id)
                      hx-post=url_for("tasks.incubate", id=task.id)
                      hx-target="#modal"
                    )
                      button.button.is-success.is-fullwidth(type="submit")
                        span.icon: i.fas.fa-umbrella(aria-hidden="true")
                        span Incubate it!
                .columns.is-mobile
                  .column: p.has-text-right If you want to keep it for reference…
                  .column
                    form(
                      method="POST"
                      action=url_for("tasks.file", id=task.id)
                      hx-post=url_for("tasks.file", id=task.id)
                      hx-target="#modal"
                    )
                      button.button.is-success.is-fullwidth(type="submit")
                        span.icon: i.fas.fa-folder-open(aria-hidden="true")
                        span File it!
                .columns.is-mobile
                  .column: p.has-text-right Else…
                  .column
                    form(
                      method="POST"
                      action=url_for("tasks.eliminate", id=task.id)
                      hx-post=url_for("tasks.eliminate", id=task.id)
                      hx-target="#modal"
                    )
                      button.button.is-danger.is-fullwidth(type="submit")
                        span.icon: i.fas.fa-trash(aria-hidden="true")
                        span Eliminate it!
          elif task.state == "actionable"
            .columns
              .column
                form(
                  method="POST"
                  action=url_for("tasks.do", id=task.id)
                  hx-post=url_for("tasks.do", id=task.id)
                  hx-target="#modal"
                )
                  button.button.is-success.is-fullwidth(type="submit")
                    span.icon: i.fas.fa-thumbs-up(aria-hidden="true")
                    span Mark it as done!
              .column
                form(
                  method="POST"
                  action=url_for("tasks.incubate", id=task.id)
                  hx-post=url_for("tasks.incubate", id=task.id)
                  hx-target="#modal"
                )
                  button.button.is-success.is-fullwidth(type="submit")
                    span.icon: i.fas.fa-umbrella(aria-hidden="true")
                    span Incubate it for a later time.
          elif task.state == "incubated"
            article.message.is-warning
              p.message-body #[strong TODO:] delegate, eliminate
            .columns
              .column
              .column
                form(
                  method="POST"
                  action=url_for("tasks.postpone", id=task.id)
                  hx-post=url_for("tasks.postpone", id=task.id)
                  hx-target="#modal"
                )
                  button.button.is-success.is-fullwidth(type="submit")
                    span.icon: i.fas.fa-chevron-circle-right(aria-hidden="true")
                    span Mark it as actionable!
              .column
          elif task.state == "scheduled"
            article.message.is-warning
              p.message-body #[strong TODO:] reschedule, postpone, delegate, eliminate
          elif task.state == "delegated"
            article.message.is-warning
              p.message-body #[strong TODO:] reclaim-do, reclaim-postpone, reclaim-incubate…
          elif task.state == "eliminated"
            article.message.is-warning
              p.message-body #[strong TODO:] send back to inbox #[strong or] copy as new
          elif task.state == "filed"
            article.message.is-info
              p.message-body This task has been kept for reference only!
            article.message.is-warning
              p.message-body #[strong TODO:] eliminate
          elif task.state == "done"
            article.message.is-info
              p.message-body This task is done, there's nothing left to do!
          else:
            article.message.is-danger
              p.message-body Sorry, I don't know what to do with #{task.state} tasks!
