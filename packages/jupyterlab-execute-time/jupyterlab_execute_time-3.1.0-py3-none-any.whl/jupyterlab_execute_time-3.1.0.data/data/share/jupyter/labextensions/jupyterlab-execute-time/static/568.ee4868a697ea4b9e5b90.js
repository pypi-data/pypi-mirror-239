"use strict";(self.webpackChunkjupyterlab_execute_time=self.webpackChunkjupyterlab_execute_time||[]).push([[568],{729:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PLUGIN_NAME=void 0;const n=i(778),s=i(930),o=i(685),a=i(830),r=i(578);t.PLUGIN_NAME="jupyterlab-execute-time";const d="execute-time",c="Previous Runs:",l="data-prev-execution-time";class h extends n.Widget{constructor(e,i,n){super(),this._updateCounter=new WeakMap,this._cellSlotMap={},this._settings={enabled:!1,highlight:!0,positioning:"left",minTime:0,textContrast:"high",showLiveExecutionTime:!0,showDate:!0,historyCount:5,dateFormat:"yyy-MM-dd HH:mm:ss"},this._panel=e,this._tracker=i,this._settingRegistry=n,this.updateConnectedCell=this.updateConnectedCell.bind(this),n.load(`${t.PLUGIN_NAME}:settings`).then((e=>{this._updateSettings(e),e.changed.connect(this._updateSettings.bind(this)),e.get("enabled").composite&&this._settingRegistry.load("@jupyterlab/notebook-extension:tracker").then((e=>e.set("recordTiming",!0)),(e=>{console.error(`jupyterlab-execute-time: Could not force metadata recording: ${e}`)}))}),(e=>{console.error(`jupyterlab-execute-time: Could not load settings, so did not active ${t.PLUGIN_NAME}: ${e}`)}))}updateConnectedCell(e,t){t.oldValues.forEach(this._deregisterMetadataChanges.bind(this)),t.newValues.forEach(this._registerMetadataChanges.bind(this))}_registerMetadataChanges(e){if(!(e.id in this._cellSlotMap)){const t=()=>this._cellMetadataChanged(e);this._cellSlotMap[e.id]=t,e.metadataChanged.connect(t)}this._cellMetadataChanged(e,!0)}_deregisterMetadataChanges(e){if(void 0!==e){const t=this._cellSlotMap[e.id];if(t){e.metadataChanged.disconnect(t);const i=this._getCodeCell(e);i&&this._removeExecuteNode(i)}delete this._cellSlotMap[e.id]}}_cellMetadataChanged(e,t=!1){const i=this._getCodeCell(e);i?this._updateCodeCell(i,t).catch(console.error):"code"===e.type&&console.error(`Could not find code cell for model: ${e}`)}_getCodeCell(e){return"code"===e.type?this._panel.content.widgets.find((t=>t.model===e)):null}_removeExecuteNode(e){const t=e.node.querySelector(`.${d}`);t&&t.remove()}async _updateCodeCell(e,t){var i;const n=this._increaseUpdateCounter(e);if(!(await e.ready,e.inViewport||await this._cellInViewport(e,n)))return;const r=e.model.getMetadata("execution");if(r&&s.JSONExt.isObject(r)){let n=e.node.querySelector(`.${d}`);const s="hover"===this._settings.positioning?e.inputArea.node.parentNode:e.inputArea.editorWidget.node;if(n)n.parentNode!==s&&(n.remove(),s.append(n));else{n=document.createElement("div"),n.appendChild(document.createElement("span"));const t=document.createElement("div");t.style.minWidth="12px",n.appendChild(t),n.appendChild(document.createElement("span")),e.inputHidden||s.append(n)}let h;switch(n.onclick=()=>{this._tracker.activeCell!==e&&e.activate()},this._settings.positioning){case"left":h="left";break;case"right":h="right";break;case"hover":h="hover";break;default:console.error(`'${h}' is not a valid type for the setting 'positioning'`)}const u=`${d}-positioning-${this._settings.positioning}`,g=`${d}-contrast-${this._settings.textContrast}`;n.className=`${d} ${u} ${g}`;const p=r["iopub.status.busy"],_=p?new Date(p):null,m=r["shell.execute_reply.started"]||r["iopub.execute_input"],f=m?new Date(m):null,C=r.execution_failed,y=null!==(i=r["shell.execute_reply"])&&void 0!==i?i:C,x=y?new Date(y):null;let b="";if(y&&!r["iopub.execute_input"])b="";else if(x){if(this._settings.minTime<=(0,a.differenceInMilliseconds)(x,f)/1e3){const e=(0,o.getTimeDiff)(x,f),t=n.getAttribute(l);if(n.setAttribute(l,e),this._settings.historyCount>0&&t){let e=n.getAttribute("title");const i=[t];e&&(i.push(...e.substring(c.length+1).split("\n")),i.length=this._settings.historyCount),e=`${c}\n${i.join("\n")}`,n.setAttribute("title",e)}n.children[2].textContent="",b=C?"Failed":"Last executed",this._settings.showDate&&(b+=` at ${(0,o.getTimeString)(x,this._settings.dateFormat)}`),b+=` in ${e}`}}else if(f){if(this._settings.showLiveExecutionTime){const i=n.getAttribute("data-prev-execution-time"),s=setInterval((()=>{if(n.children[0].textContent.startsWith("Execution started at")){if(e.model.getMetadata("execution").execution_failed)return clearInterval(s),this._updateCodeCell(e,t);if(this._settings.minTime<=(0,a.differenceInMilliseconds)(new Date,f)/1e3){const e=(0,o.getTimeDiff)(new Date,f);n.children[2].textContent=`${e} ${i?`(${i})`:""}`}}else clearInterval(s)}),100)}b=`Execution started at ${(0,o.getTimeString)(f,this._settings.dateFormat)}`}else if(_){const e=n.getAttribute("data-prev-execution-time");this._settings.showLiveExecutionTime&&e&&(n.children[2].textContent=`N/A (${e})`),b=`Execution queued at ${(0,o.getTimeString)(_,this._settings.dateFormat)}`}n.textContent!==b&&(n.children[0].textContent=b,!t&&this._settings.highlight&&y&&(n.style.setProperty("animation","executeHighlight 1000ms"),setTimeout((()=>n.style.removeProperty("animation")),1e3)))}else{const t=e.node.querySelector(`.${d}`);t&&t.classList.add("execute-time-hidden")}}_updateSettings(e){this._settings.enabled=e.get("enabled").composite,this._settings.highlight=e.get("highlight").composite,this._settings.positioning=e.get("positioning").composite,this._settings.minTime=e.get("minTime").composite,this._settings.textContrast=e.get("textContrast").composite,this._settings.showLiveExecutionTime=e.get("showLiveExecutionTime").composite,this._settings.showDate=e.get("showDate").composite,this._settings.historyCount=e.get("historyCount").composite;const t=e.get("dateFormat").composite,i=(0,o.validateDateFormat)(t);i.isValid?this._settings.dateFormat=t:(this._settings.dateFormat="yyy-MM-dd HH:mm:ss",(0,r.showErrorMessage)("Invalid date format in Execute Time extension setting",i.message));const n=this._panel.context.model.cells;if(this._settings.enabled){n.changed.connect(this.updateConnectedCell);for(let e=0;e<n.length;++e)this._registerMetadataChanges(n.get(e))}else{n.changed.disconnect(this.updateConnectedCell);for(let e=0;e<n.length;++e)this._deregisterMetadataChanges(n.get(e))}}_cellInViewport(e,t){return new Promise((i=>{const n=()=>{e.inViewportChanged.disconnect(s),e.disposed.disconnect(o),this._panel.disposed.disconnect(o)},s=(s,o)=>{const a=this._updateCounter.get(e);return t!==a?(n(),i(!1)):o?(n(),i(!0)):void 0},o=()=>(n(),i(!1));e.inViewportChanged.connect(s),e.disposed.connect(o),this._panel.disposed.connect(o)}))}_increaseUpdateCounter(e){var t;const i=(null!==(t=this._updateCounter.get(e))&&void 0!==t?t:0)+1;return this._updateCounter.set(e,i),i}}t.default=h},685:(e,t,i)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getTimeDiff=t.getTimeString=t.validateDateFormat=void 0;const n=i(830);t.validateDateFormat=e=>{const t=new Date;try{return(0,n.format)(t,e),{isValid:!0}}catch(e){return{isValid:!1,message:e.message}}},t.getTimeString=(e,t="yyy-MM-dd HH:mm:ss")=>(0,n.format)(e,t),t.getTimeDiff=(e,t)=>{const i=36e5,s=864e5;let o=(0,n.differenceInMilliseconds)(e,t);if(o<1e3)return`${o}ms`;const a=Math.floor(o/s);o%=s;const r=Math.floor(o/i);o%=i;const d=Math.floor(o/6e4);o%=6e4;let c="";return a&&(c+=`${a}d `),(a||r)&&(c+=`${r}h `),(a||r||d)&&(c+=`${d}m `),a||(c+=`${(o/1e3).toFixed(r?0:2)}s`),c.trim()}},568:function(e,t,i){var n=this&&this.__createBinding||(Object.create?function(e,t,i,n){void 0===n&&(n=i);var s=Object.getOwnPropertyDescriptor(t,i);s&&!("get"in s?!t.__esModule:s.writable||s.configurable)||(s={enumerable:!0,get:function(){return t[i]}}),Object.defineProperty(e,n,s)}:function(e,t,i,n){void 0===n&&(n=i),e[n]=t[i]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var i in e)"default"!==i&&Object.prototype.hasOwnProperty.call(e,i)&&n(t,e,i);return s(t,e),t};Object.defineProperty(t,"__esModule",{value:!0});const a=i(167),r=i(408),d=o(i(729));class c{constructor(e,t){this._settingRegistry=t,this._tracker=e}createNew(e,t){return new d.default(e,this._tracker,this._settingRegistry)}}const l={id:d.PLUGIN_NAME,autoStart:!0,requires:[a.INotebookTracker,r.ISettingRegistry],activate:(e,t,i)=>{e.docRegistry.addWidgetExtension("Notebook",new c(t,i)),console.log("JupyterLab extension jupyterlab-execute-time is activated!")}};t.default=l}}]);