import{S as $,i as ee,s as te,E as A,Z as O,_ as U,m as b,h as d,n as E,$ as K,b as y,a0 as p,L as me,a1 as z,N as F,Q as W,q as M,r as I,u as j,k as H,y as ie,l as P,z as ne,G as R,A as se,a7 as de,V as ut,g as S,d as N,B as ae,a as Q,c as Z,v as J,f as x,a2 as Ze,a3 as Ce,C as ft,H as he,M as Je,W as xe,X as dt,p as q,ag as ht,ao as mt,a4 as gt,O as we,ai as _t,e as He,a8 as Pe}from"./index.c33bdc5f.js";import{ax as Ve,d as pt,h as $e,L as bt,$ as Ee,Y as et,a8 as tt,aj as vt,ai as oe,a1 as Se,g as kt,b0 as wt,al as Et,b4 as St,au as yt,bu as Nt,B as lt,bm as Ct}from"./Commands.b4e0396c.js";import{f as Be,g as Ht}from"./notificationsStore.bf4bc03e.js";import{c as ye,L as Le,a as Te}from"./colors.f6cbcb11.js";function ze(i){let e,l;return{c(){e=O("title"),l=M(i[1])},l(t){e=U(t,"title",{});var s=b(e);l=I(s,i[1]),s.forEach(d)},m(t,s){y(t,e,s),p(e,l)},p(t,s){s&2&&j(l,t[1])},d(t){t&&d(e)}}}function Pt(i){let e,l,t=i[1]&&ze(i),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:i[0]},{height:i[0]},i[2],i[3]],c={};for(let n=0;n<s.length;n+=1)c=A(c,s[n]);return{c(){e=O("svg"),t&&t.c(),l=O("path"),this.h()},l(n){e=U(n,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var a=b(e);t&&t.l(a),l=U(a,"path",{d:!0}),b(l).forEach(d),a.forEach(d),this.h()},h(){E(l,"d","M24.59 16.59L17 24.17 17 4 15 4 15 24.17 7.41 16.59 6 18 16 28 26 18 24.59 16.59z"),K(e,c)},m(n,a){y(n,e,a),t&&t.m(e,null),p(e,l)},p(n,[a]){n[1]?t?t.p(n,a):(t=ze(n),t.c(),t.m(e,l)):t&&(t.d(1),t=null),K(e,c=me(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:n[0]},a&1&&{height:n[0]},a&4&&n[2],a&8&&n[3]]))},i:z,o:z,d(n){n&&d(e),t&&t.d()}}}function Vt(i,e,l){let t,s;const c=["size","title"];let n=F(e,c),{size:a=16}=e,{title:r=void 0}=e;return i.$$set=o=>{l(5,e=A(A({},e),W(o))),l(3,n=F(e,c)),"size"in o&&l(0,a=o.size),"title"in o&&l(1,r=o.title)},i.$$.update=()=>{l(4,t=e["aria-label"]||e["aria-labelledby"]||r),l(2,s={"aria-hidden":t?void 0:!0,role:t?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=W(e),[a,r,s,n,t]}class Bt extends ${constructor(e){super(),ee(this,e,Vt,Pt,te,{size:0,title:1})}}function Me(i){let e,l;return{c(){e=O("title"),l=M(i[1])},l(t){e=U(t,"title",{});var s=b(e);l=I(s,i[1]),s.forEach(d)},m(t,s){y(t,e,s),p(e,l)},p(t,s){s&2&&j(l,t[1])},d(t){t&&d(e)}}}function Lt(i){let e,l,t=i[1]&&Me(i),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:i[0]},{height:i[0]},i[2],i[3]],c={};for(let n=0;n<s.length;n+=1)c=A(c,s[n]);return{c(){e=O("svg"),t&&t.c(),l=O("path"),this.h()},l(n){e=U(n,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var a=b(e);t&&t.l(a),l=U(a,"path",{d:!0}),b(l).forEach(d),a.forEach(d),this.h()},h(){E(l,"d","M16 4L6 14 7.41 15.41 15 7.83 15 28 17 28 17 7.83 24.59 15.41 26 14 16 4z"),K(e,c)},m(n,a){y(n,e,a),t&&t.m(e,null),p(e,l)},p(n,[a]){n[1]?t?t.p(n,a):(t=Me(n),t.c(),t.m(e,l)):t&&(t.d(1),t=null),K(e,c=me(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:n[0]},a&1&&{height:n[0]},a&4&&n[2],a&8&&n[3]]))},i:z,o:z,d(n){n&&d(e),t&&t.d()}}}function Tt(i,e,l){let t,s;const c=["size","title"];let n=F(e,c),{size:a=16}=e,{title:r=void 0}=e;return i.$$set=o=>{l(5,e=A(A({},e),W(o))),l(3,n=F(e,c)),"size"in o&&l(0,a=o.size),"title"in o&&l(1,r=o.title)},i.$$.update=()=>{l(4,t=e["aria-label"]||e["aria-labelledby"]||r),l(2,s={"aria-hidden":t?void 0:!0,role:t?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=W(e),[a,r,s,n,t]}class zt extends ${constructor(e){super(),ee(this,e,Tt,Lt,te,{size:0,title:1})}}function Ie(i){let e,l;return{c(){e=O("title"),l=M(i[1])},l(t){e=U(t,"title",{});var s=b(e);l=I(s,i[1]),s.forEach(d)},m(t,s){y(t,e,s),p(e,l)},p(t,s){s&2&&j(l,t[1])},d(t){t&&d(e)}}}function Mt(i){let e,l,t=i[1]&&Ie(i),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:i[0]},{height:i[0]},i[2],i[3]],c={};for(let n=0;n<s.length;n+=1)c=A(c,s[n]);return{c(){e=O("svg"),t&&t.c(),l=O("path"),this.h()},l(n){e=U(n,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var a=b(e);t&&t.l(a),l=U(a,"path",{d:!0}),b(l).forEach(d),a.forEach(d),this.h()},h(){E(l,"d","M2 2H7V16H2zM23 2H9V16.8027l3.0422 4.5635.8453 5.9165A2.0094 2.0094 0 0014.8672 29H15a3.0033 3.0033 0 003-3V20h8a4.0045 4.0045 0 004-4V9A7.0078 7.0078 0 0023 2z"),K(e,c)},m(n,a){y(n,e,a),t&&t.m(e,null),p(e,l)},p(n,[a]){n[1]?t?t.p(n,a):(t=Ie(n),t.c(),t.m(e,l)):t&&(t.d(1),t=null),K(e,c=me(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:n[0]},a&1&&{height:n[0]},a&4&&n[2],a&8&&n[3]]))},i:z,o:z,d(n){n&&d(e),t&&t.d()}}}function It(i,e,l){let t,s;const c=["size","title"];let n=F(e,c),{size:a=16}=e,{title:r=void 0}=e;return i.$$set=o=>{l(5,e=A(A({},e),W(o))),l(3,n=F(e,c)),"size"in o&&l(0,a=o.size),"title"in o&&l(1,r=o.title)},i.$$.update=()=>{l(4,t=e["aria-label"]||e["aria-labelledby"]||r),l(2,s={"aria-hidden":t?void 0:!0,role:t?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=W(e),[a,r,s,n,t]}class At extends ${constructor(e){super(),ee(this,e,It,Mt,te,{size:0,title:1})}}function Ae(i){let e,l;return{c(){e=O("title"),l=M(i[1])},l(t){e=U(t,"title",{});var s=b(e);l=I(s,i[1]),s.forEach(d)},m(t,s){y(t,e,s),p(e,l)},p(t,s){s&2&&j(l,t[1])},d(t){t&&d(e)}}}function Rt(i){let e,l,t=i[1]&&Ae(i),s=[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},{width:i[0]},{height:i[0]},i[2],i[3]],c={};for(let n=0;n<s.length;n+=1)c=A(c,s[n]);return{c(){e=O("svg"),t&&t.c(),l=O("path"),this.h()},l(n){e=U(n,"svg",{xmlns:!0,viewBox:!0,fill:!0,preserveAspectRatio:!0,width:!0,height:!0});var a=b(e);t&&t.l(a),l=U(a,"path",{d:!0}),b(l).forEach(d),a.forEach(d),this.h()},h(){E(l,"d","M2 16H7V30H2zM23 30H9V15.1973l3.0422-4.5635.8453-5.9165A2.0094 2.0094 0 0114.8672 3H15a3.0033 3.0033 0 013 3v6h8a4.0045 4.0045 0 014 4v7A7.0078 7.0078 0 0123 30z"),K(e,c)},m(n,a){y(n,e,a),t&&t.m(e,null),p(e,l)},p(n,[a]){n[1]?t?t.p(n,a):(t=Ae(n),t.c(),t.m(e,l)):t&&(t.d(1),t=null),K(e,c=me(s,[{xmlns:"http://www.w3.org/2000/svg"},{viewBox:"0 0 32 32"},{fill:"currentColor"},{preserveAspectRatio:"xMidYMid meet"},a&1&&{width:n[0]},a&1&&{height:n[0]},a&4&&n[2],a&8&&n[3]]))},i:z,o:z,d(n){n&&d(e),t&&t.d()}}}function Dt(i,e,l){let t,s;const c=["size","title"];let n=F(e,c),{size:a=16}=e,{title:r=void 0}=e;return i.$$set=o=>{l(5,e=A(A({},e),W(o))),l(3,n=F(e,c)),"size"in o&&l(0,a=o.size),"title"in o&&l(1,r=o.title)},i.$$.update=()=>{l(4,t=e["aria-label"]||e["aria-labelledby"]||r),l(2,s={"aria-hidden":t?void 0:!0,role:t?"img":void 0,focusable:Number(e.tabindex)===0?!0:void 0})},e=W(e),[a,r,s,n,t]}class Ot extends ${constructor(e){super(),ee(this,e,Dt,Rt,te,{size:0,title:1})}}function Ut(i,e){const l=t=>i&&!i.contains(t.target)&&!t.defaultPrevented&&e();return document.addEventListener("click",l,!0),{destroy(){document.removeEventListener("click",l,!0)}}}function Yt(i){let e=(i[1]?"":i[0])+"",l;return{c(){l=M(e)},l(t){l=I(t,e)},m(t,s){y(t,l,s)},p(t,s){s&3&&e!==(e=(t[1]?"":t[0])+"")&&j(l,e)},d(t){t&&d(l)}}}function Ft(i){let e,l,t,s,c;const n=[i[2],{type:"purple"},{icon:Ve}];let a={$$slots:{default:[Yt]},$$scope:{ctx:i}};for(let r=0;r<n.length;r+=1)a=A(a,n[r]);return l=new pt({props:a}),{c(){e=H("div"),ie(l.$$.fragment),this.h()},l(r){e=P(r,"DIV",{class:!0});var o=b(e);ne(l.$$.fragment,o),o.forEach(d),this.h()},h(){E(e,"class","embedding-badge truncate"),R(e,"embedding-badge-nolabel",i[1])},m(r,o){y(r,e,o),se(l,e,null),t=!0,s||(c=de($e.call(null,e,{text:"Embedding index"})),s=!0)},p(r,[o]){const u=o&4?me(n,[o&4&&ut(r[2]),n[1],o&0&&{icon:Ve}]):{};o&11&&(u.$$scope={dirty:o,ctx:r}),l.$set(u),(!t||o&2)&&R(e,"embedding-badge-nolabel",r[1])},i(r){t||(S(l.$$.fragment,r),t=!0)},o(r){N(l.$$.fragment,r),t=!1},d(r){r&&d(e),ae(l),s=!1,c()}}}function jt(i,e,l){const t=["embedding","hideEmbeddingName"];let s=F(e,t),{embedding:c}=e,{hideEmbeddingName:n=!1}=e;return i.$$set=a=>{e=A(A({},e),W(a)),l(2,s=F(e,t)),"embedding"in a&&l(0,c=a.embedding),"hideEmbeddingName"in a&&l(1,n=a.hideEmbeddingName)},[c,n,s]}class qt extends ${constructor(e){super(),ee(this,e,jt,Ft,te,{embedding:0,hideEmbeddingName:1})}}function Re(i,e,l){const t=i.slice();return t[12]=e[l],t}function De(i){let e,l,t=i[0].conceptNamespace+"",s,c,n=i[0].conceptName+"",a,r,o,u,f,m,g,v,_,k,w;return f=new Ot({}),v=new At({}),{c(){e=H("div"),l=H("div"),s=M(t),c=M(" / "),a=M(n),r=Q(),o=H("div"),u=H("button"),ie(f.$$.fragment),m=Q(),g=H("button"),ie(v.$$.fragment),this.h()},l(C){e=P(C,"DIV",{class:!0});var L=b(e);l=P(L,"DIV",{class:!0});var D=b(l);s=I(D,t),c=I(D," / "),a=I(D,n),D.forEach(d),r=Z(L),o=P(L,"DIV",{class:!0});var B=b(o);u=P(B,"BUTTON",{class:!0});var T=b(u);ne(f.$$.fragment,T),T.forEach(d),m=Z(B),g=P(B,"BUTTON",{class:!0});var le=b(g);ne(v.$$.fragment,le),le.forEach(d),B.forEach(d),L.forEach(d),this.h()},h(){E(l,"class","flex-grow"),E(u,"class","p-1"),E(g,"class","p-1"),E(o,"class","shrink-0"),E(e,"class","flex flex-row items-center justify-between gap-x-4 p-2")},m(C,L){y(C,e,L),p(e,l),p(l,s),p(l,c),p(l,a),p(e,r),p(e,o),p(o,u),se(f,u,null),p(o,m),p(o,g),se(v,g,null),_=!0,k||(w=[he(u,"click",i[8]),he(g,"click",i[9])],k=!0)},p(C,L){(!_||L&1)&&t!==(t=C[0].conceptNamespace+"")&&j(s,t),(!_||L&1)&&n!==(n=C[0].conceptName+"")&&j(a,n)},i(C){_||(S(f.$$.fragment,C),S(v.$$.fragment,C),_=!0)},o(C){N(f.$$.fragment,C),N(v.$$.fragment,C),_=!1},d(C){C&&d(e),ae(f),ae(v),k=!1,Je(w)}}}function Oe(i){let e,l=[],t=new Map,s,c=i[2];const n=a=>a[12];for(let a=0;a<c.length;a+=1){let r=Re(i,c,a),o=n(r);t.set(o,l[a]=Ue(o,r))}return{c(){e=H("div");for(let a=0;a<l.length;a+=1)l[a].c();this.h()},l(a){e=P(a,"DIV",{class:!0});var r=b(e);for(let o=0;o<l.length;o+=1)l[o].l(r);r.forEach(d),this.h()},h(){E(e,"class","more-button flex flex-col")},m(a,r){y(a,e,r);for(let o=0;o<l.length;o+=1)l[o]&&l[o].m(e,null);s=!0},p(a,r){r&29&&(c=a[2],J(),l=xe(l,r,n,1,a,c,t,e,dt,Ue,null,Re),x())},i(a){if(!s){for(let r=0;r<c.length;r+=1)S(l[r]);s=!0}},o(a){for(let r=0;r<l.length;r+=1)N(l[r]);s=!1},d(a){a&&d(e);for(let r=0;r<l.length;r+=1)l[r].d()}}}function Ue(i,e){let l,t,s,c,n,a,r,o,u;n=new qt({props:{class:"hover:cursor-pointer",embedding:e[12]}});function f(){return e[10](e[12])}return{key:i,first:null,c(){l=H("button"),t=H("div"),s=M("Find similar"),c=Q(),ie(n.$$.fragment),a=Q(),this.h()},l(m){l=P(m,"BUTTON",{class:!0});var g=b(l);t=P(g,"DIV",{});var v=b(t);s=I(v,"Find similar"),v.forEach(d),c=Z(g),ne(n.$$.fragment,g),a=Z(g),g.forEach(d),this.h()},h(){E(l,"class","flex w-full items-center justify-between"),this.first=l},m(m,g){y(m,l,g),p(l,t),p(t,s),p(l,c),se(n,l,null),p(l,a),r=!0,o||(u=he(l,"click",f),o=!0)},p(m,g){e=m;const v={};g&4&&(v.embedding=e[12]),n.$set(v)},i(m){r||(S(n.$$.fragment,m),r=!0)},o(m){N(n.$$.fragment,m),r=!1},d(m){m&&d(l),ae(n),o=!1,u()}}}function Wt(i){let e,l,t,s,c,n,a,r=i[0].conceptName!=null&&i[0].conceptNamespace!=null&&De(i),o=i[3]!=null&&Oe(i);return{c(){e=H("div"),r&&r.c(),l=Q(),o&&o.c(),this.h()},l(u){e=P(u,"DIV",{style:!0,class:!0});var f=b(e);r&&r.l(f),l=Z(f),o&&o.l(f),f.forEach(d),this.h()},h(){E(e,"style",t=i[1]!=null?`left: ${i[1].x}px; top: ${i[1].y}px`:""),E(e,"class","absolute z-10 inline-flex -translate-x-1/2 translate-y-6 flex-col divide-y divide-gray-200 rounded border border-gray-200 bg-white shadow")},m(u,f){y(u,e,f),r&&r.m(e,null),p(e,l),o&&o.m(e,null),c=!0,n||(a=de(Ut.call(null,e,i[11])),n=!0)},p(u,[f]){u[0].conceptName!=null&&u[0].conceptNamespace!=null?r?(r.p(u,f),f&1&&S(r,1)):(r=De(u),r.c(),S(r,1),r.m(e,l)):r&&(J(),N(r,1,1,()=>{r=null}),x()),u[3]!=null?o?(o.p(u,f),f&8&&S(o,1)):(o=Oe(u),o.c(),S(o,1),o.m(e,null)):o&&(J(),N(o,1,1,()=>{o=null}),x()),(!c||f&2&&t!==(t=u[1]!=null?`left: ${u[1].x}px; top: ${u[1].y}px`:""))&&E(e,"style",t)},i(u){c||(S(r),S(o),Ze(()=>{c&&(s||(s=Ce(e,Be,{duration:60},!0)),s.run(1))}),c=!0)},o(u){N(r),N(o),s||(s=Ce(e,Be,{duration:60},!1)),s.run(0),c=!1},d(u){u&&d(e),r&&r.d(),o&&o.d(),u&&s&&s.end(),n=!1,a()}}}function Xt(i,e,l){let{details:t}=e,{clickPosition:s}=e,{embeddings:c}=e,{addConceptLabel:n}=e,{findSimilar:a}=e,{addNotification:r}=e;const o=ft();function u(_){if(!t.conceptName||!t.conceptNamespace)throw Error("Label could not be added, no active concept.");n(t.conceptNamespace,t.conceptName,t.text,_),r({kind:"success",title:`[${_===!0?"Positive":"Negative"}] Concept label added`,subtitle:bt(t.conceptNamespace,t.conceptName),message:t.text}),o("click")}const f=()=>u(!0),m=()=>u(!1),g=_=>{a&&a(_,t.text),o("click")},v=()=>o("close");return i.$$set=_=>{"details"in _&&l(0,t=_.details),"clickPosition"in _&&l(1,s=_.clickPosition),"embeddings"in _&&l(2,c=_.embeddings),"addConceptLabel"in _&&l(6,n=_.addConceptLabel),"findSimilar"in _&&l(3,a=_.findSimilar),"addNotification"in _&&l(7,r=_.addNotification)},[t,s,c,a,o,u,n,r,f,m,g,v]}class Gt extends ${constructor(e){super(),ee(this,e,Xt,Wt,te,{details:0,clickPosition:1,embeddings:2,addConceptLabel:6,findSimilar:3,addNotification:7})}}function Kt(i,e){let l,t=e;i.addEventListener("click",n=>s(n));function s(n){t.disabled||(l=new Gt({props:{details:t.details(),clickPosition:{x:n.clientX,y:n.clientY},embeddings:t.embeddings,addConceptLabel:t.addConceptLabel,addNotification:t.addNotification,findSimilar:t.findSimilar},target:document.body}),l.$on("close",c),l.$on("click",c))}function c(){l==null||l.$destroy(),l=void 0}return{update(n){t=n,l==null||l.$set({details:t.details()})},destroy(){c()}}}function Ye(i,e,l){const t=i.slice();return t[7]=e[l],t}function Fe(i,e){let l,t,s=e[7].info.name+"",c,n,a,r,o=je(e[7])+"",u,f;return{key:i,first:null,c(){l=H("div"),t=H("div"),c=M(s),n=Q(),a=H("div"),r=H("span"),u=M(o),f=Q(),this.h()},l(m){l=P(m,"DIV",{class:!0});var g=b(l);t=P(g,"DIV",{class:!0});var v=b(t);c=I(v,s),v.forEach(d),n=Z(g),a=P(g,"DIV",{class:!0});var _=b(a);r=P(_,"SPAN",{class:!0});var k=b(r);u=I(k,o),k.forEach(d),_.forEach(d),f=Z(g),g.forEach(d),this.h()},h(){E(t,"class","named-value-name table-cell max-w-xs truncate pr-2 svelte-1689hje"),E(r,"class","px-1"),R(r,"font-bold",e[7].info.type==="keyword"||e[7].info.type==="metadata"&&!Ee(e[7].info.dtype)),q(r,"background-color",(e[7].info.type==="concept_score"||e[7].info.type==="semantic_similarity")&&typeof e[7].value=="number"?ye(e[7].value):""),E(a,"class","table-cell rounded text-right"),E(l,"class","table-row"),this.first=l},m(m,g){y(m,l,g),p(l,t),p(t,c),p(l,n),p(l,a),p(a,r),p(r,u),p(l,f)},p(m,g){e=m,g&1&&s!==(s=e[7].info.name+"")&&j(c,s),g&1&&o!==(o=je(e[7])+"")&&j(u,o),g&1&&R(r,"font-bold",e[7].info.type==="keyword"||e[7].info.type==="metadata"&&!Ee(e[7].info.dtype)),g&1&&q(r,"background-color",(e[7].info.type==="concept_score"||e[7].info.type==="semantic_similarity")&&typeof e[7].value=="number"?ye(e[7].value):"")},d(m){m&&d(l)}}}function Qt(i){let e,l,t=[],s=new Map,c,n=`${i[4]}px`,a=`${Math.min(i[1],i[3]-i[2]-20)}px`,r=i[0];const o=u=>u[7];for(let u=0;u<r.length;u+=1){let f=Ye(i,r,u),m=o(f);s.set(m,t[u]=Fe(m,f))}return{c(){e=H("div"),l=H("div");for(let u=0;u<t.length;u+=1)t[u].c();this.h()},l(u){e=P(u,"DIV",{role:!0,class:!0});var f=b(e);l=P(f,"DIV",{class:!0});var m=b(l);for(let g=0;g<t.length;g+=1)t[g].l(m);m.forEach(d),f.forEach(d),this.h()},h(){E(l,"class","table border-spacing-y-2"),E(e,"role","tooltip"),E(e,"class","absolute max-w-fit -translate-y-full break-words border border-gray-300 bg-white px-2 shadow-md"),Ze(()=>i[6].call(e)),R(e,"hidden",i[0].length===0),q(e,"top",n),q(e,"left",a)},m(u,f){y(u,e,f),p(e,l);for(let m=0;m<t.length;m+=1)t[m]&&t[m].m(l,null);c=ht(e,i[6].bind(e))},p(u,[f]){f&1&&(r=u[0],t=xe(t,f,o,1,u,r,s,l,mt,Fe,null,Ye)),f&1&&R(e,"hidden",u[0].length===0),f&6&&a!==(a=`${Math.min(u[1],u[3]-u[2]-20)}px`)&&q(e,"left",a)},i:z,o:z,d(u){u&&d(e);for(let f=0;f<t.length;f+=1)t[f].d();c()}}}function je(i){return typeof i.value=="number"?i.value.toFixed(3):i.info.dtype==="string_span"?"true":i.value}function Zt(i,e,l){let{namedValues:t}=e,{x:s}=e,{y:c}=e;const n=window.innerWidth;let a=0;const r=c-1;function o(){a=this.clientWidth,l(2,a)}return i.$$set=u=>{"namedValues"in u&&l(0,t=u.namedValues),"x"in u&&l(1,s=u.x),"y"in u&&l(5,c=u.y)},[t,s,a,n,r,c,o]}class Jt extends ${constructor(e){super(),ee(this,e,Zt,Qt,te,{namedValues:0,x:1,y:5})}}function xt(i,e){let l,t=e;const s=()=>n();t.isHovered&&c();function c(){const a=t.namedValues.filter(m=>Array.from(t.spansHovered).some(g=>{const v=et(g);return tt(m.specificPath.slice(0,v.length),v)}));t.itemScrollContainer!=null&&t.itemScrollContainer.addEventListener("scroll",s);const r=i.getBoundingClientRect(),o=window.getComputedStyle(i),u=parseInt(o.getPropertyValue("line-height")),f=r.height>u?r.x+i.offsetLeft||i.clientLeft:r.x;l=new Jt({props:{namedValues:a,x:f,y:r.top},target:document.body})}function n(){var a;l==null||l.$destroy(),(a=t.itemScrollContainer)==null||a.removeEventListener("scroll",s)}return{update(a){n(),t=a,t.isHovered&&c()},destroy(){n()}}}const qe=300,be=50;function $t(i,e,l){const t=[],s=new Set;for(const c of i){let n=!1;const a=[];for(const w of c.paths)s.has(w)||(a.push(w),s.add(w));const r=[],o=[];let u=-1/0;for(const[w,C]of Object.entries(c.originalSpans)){const L=e[w],D=et(w);if(!(L==null||L.length===0))for(const B of C)for(const T of L){const le=T.path.slice(D.length),X=vt(B,le);if(X==null)continue;const Y=oe.value(X),ge=oe.span(X);if(Y==null&&ge==null)continue;if(T.dtype==="float32"){const re=oe.value(X);re!=null&&(u=Math.max(u,re))}const _e=Se(oe.path(B)),ve=!a.includes(_e),G={value:Y,info:T,specificPath:oe.path(X)};ve||r.push(G),o.push(G),T.type==="concept_score"||T.type==="semantic_similarity"?Y>.5&&(n=!0):n=!0}}const f=o.some(w=>w.info.type==="label"),m=o.some(w=>w.info.type==="leaf_span"),g=o.some(w=>w.info.type==="keyword"),v=o.some(w=>w.info.type==="metadata"&&!Ee(w.info.dtype)),_=c.paths.some(w=>l.has(w)),k=_&&a.length>0&&Array.from(l).some(w=>a.includes(w));t.push({backgroundColor:ye(u),isBlackBolded:g||v||m,isHighlightBolded:f,isHighlighted:n,snippetScore:u,namedValues:r,paths:c.paths,text:c.text,originalSpans:c.originalSpans,isHovered:_,isFirstHover:k})}return t}function el(i,e){var c;if(e)return{snippetSpans:i.map(n=>({renderSpan:n,snippetText:n.text})),someSnippetsHidden:!1};let l=!1,t=!1,s=[];for(let n=0;n<i.length;n++){const a=i[n],r=n-1>=0?i[n-1]:null,o=n+1<i.length?i[n+1]:null,u=(c=s.at(-1))==null?void 0:c.isEllipsis;if(!a.isHighlighted){if(u||r!=null&&r.isHighlighted||o!=null&&o.isHighlighted)continue;l=!0,s.push({isEllipsis:!0});continue}t=!0,r!=null&&!r.isHighlighted&&(!u&&r.text.length>be&&(s.push({isEllipsis:!0}),l=!0),s.push({renderSpan:r,snippetText:r.text.slice(-be)})),s.push({renderSpan:a,snippetText:a.text}),o!=null&&!o.isHighlighted&&(s.push({renderSpan:o,snippetText:o.text.slice(0,be)}),!u&&o.text.length>be&&(s.push({isEllipsis:!0}),l=!0))}return t||(s=[],l=!1,s.push({renderSpan:i[0],snippetText:i[0].text.slice(0,qe)}),((i[1]||null)!=null||i[0].text.length>qe)&&(s.push({isEllipsis:!0}),l=!0)),{snippetSpans:s,someSnippetsHidden:l}}function We(i,e,l){const t=i.slice();return t[35]=e[l],t}function tl(i){const e=i.slice(),l=e[35].renderSpan;return e[38]=l,e}function ll(i){let e,l,t,s;return{c(){e=H("span"),l=M("..."),this.h()},l(c){e=P(c,"SPAN",{class:!0});var n=b(e);l=I(n,"..."),n.forEach(d),this.h()},h(){E(e,"class","highlight-span text-sm leading-5 svelte-10l1gaq")},m(c,n){y(c,e,n),p(e,l),t||(s=de($e.call(null,e,{text:`Some text was hidden to improve readability. 
Click "Show all" to show the entire document.`})),t=!0)},p:z,i:z,o:z,d(c){c&&d(e),t=!1,s()}}}function il(i){let e,l,t,s,c,n,a,r;const o=[sl,nl],u=[];function f(_,k){return _[1]?0:1}l=f(i),t=u[l]=o[l](i);function m(){return i[29](i[38])}function g(){return i[30](i[38])}function v(){return i[31](i[38])}return{c(){e=H("span"),t.c(),this.h()},l(_){e=P(_,"SPAN",{class:!0});var k=b(e);t.l(k),k.forEach(d),this.h()},h(){E(e,"class","hover:cursor-poiner highlight-span break-words text-sm leading-5 svelte-10l1gaq"),R(e,"highlighted",i[38].isHighlighted),R(e,"hover:cursor-pointer",i[0].length>0),R(e,"font-bold",i[38].isBlackBolded),R(e,"font-medium",i[38].isHighlightBolded&&!i[38].isBlackBolded),q(e,"color",i[38].isHighlightBolded&&!i[38].isBlackBolded?Le:""),q(e,"background-color",i[38].isHovered?Te(Ke):i[38].backgroundColor)},m(_,k){y(_,e,k),u[l].m(e,null),n=!0,a||(r=[de(s=xt.call(null,e,{namedValues:i[38].namedValues,isHovered:i[38].isFirstHover,spansHovered:i[3],itemScrollContainer:i[7]})),de(c=Kt.call(null,e,{details:m,findSimilar:i[8].page==="datasets"?i[16]:null,embeddings:i[2],addConceptLabel:i[14],addNotification:i[17]!=null?i[17].addNotification:Qe,disabled:i[38].paths.length===0||i[2].length===0})),he(e,"mouseenter",g),he(e,"mouseleave",v)],a=!0)},p(_,k){i=_;let w=l;l=f(i),l===w?u[l].p(i,k):(J(),N(u[w],1,1,()=>{u[w]=null}),x(),t=u[l],t?t.p(i,k):(t=u[l]=o[l](i),t.c()),S(t,1),t.m(e,null)),s&&Pe(s.update)&&k[0]&200&&s.update.call(null,{namedValues:i[38].namedValues,isHovered:i[38].isFirstHover,spansHovered:i[3],itemScrollContainer:i[7]}),c&&Pe(c.update)&&k[0]&324&&c.update.call(null,{details:m,findSimilar:i[8].page==="datasets"?i[16]:null,embeddings:i[2],addConceptLabel:i[14],addNotification:i[17]!=null?i[17].addNotification:Qe,disabled:i[38].paths.length===0||i[2].length===0}),(!n||k[0]&64)&&R(e,"highlighted",i[38].isHighlighted),(!n||k[0]&1)&&R(e,"hover:cursor-pointer",i[0].length>0),(!n||k[0]&64)&&R(e,"font-bold",i[38].isBlackBolded),(!n||k[0]&64)&&R(e,"font-medium",i[38].isHighlightBolded&&!i[38].isBlackBolded),k[0]&64&&q(e,"color",i[38].isHighlightBolded&&!i[38].isBlackBolded?Le:""),k[0]&64&&q(e,"background-color",i[38].isHovered?Te(Ke):i[38].backgroundColor)},i(_){n||(S(t),n=!0)},o(_){N(t),n=!1},d(_){_&&d(e),u[l].d(),a=!1,Je(r)}}}function nl(i){let e=i[35].snippetText+"",l;return{c(){l=M(e)},l(t){l=I(t,e)},m(t,s){y(t,l,s)},p(t,s){s[0]&64&&e!==(e=t[35].snippetText+"")&&j(l,e)},i:z,o:z,d(t){t&&d(l)}}}function sl(i){let e,l;return e=new Ct({props:{source:i[35].snippetText}}),{c(){ie(e.$$.fragment)},l(t){ne(e.$$.fragment,t)},m(t,s){se(e,t,s),l=!0},p(t,s){const c={};s[0]&64&&(c.source=t[35].snippetText),e.$set(c)},i(t){l||(S(e.$$.fragment,t),l=!0)},o(t){N(e.$$.fragment,t),l=!1},d(t){ae(e,t)}}}function Xe(i){let e,l,t,s;const c=[il,ll],n=[];function a(o,u){return o[35].isEllipsis?1:0}function r(o,u){return u===0?tl(o):o}return e=a(i),l=n[e]=c[e](r(i,e)),{c(){l.c(),t=He()},l(o){l.l(o),t=He()},m(o,u){n[e].m(o,u),y(o,t,u),s=!0},p(o,u){let f=e;e=a(o),e===f?n[e].p(r(o,e),u):(J(),N(n[f],1,1,()=>{n[f]=null}),x(),l=n[e],l?l.p(r(o,e),u):(l=n[e]=c[e](r(o,e)),l.c()),S(l,1),l.m(t.parentNode,t))},i(o){s||(S(l),s=!0)},o(o){N(l),s=!1},d(o){n[e].d(o),o&&d(t)}}}function Ge(i){let e,l,t,s,c;const n=[ol,al],a=[];function r(o,u){return o[4]?1:0}return t=r(i),s=a[t]=n[t](i),{c(){e=H("div"),l=H("div"),s.c(),this.h()},l(o){e=P(o,"DIV",{class:!0});var u=b(e);l=P(u,"DIV",{class:!0});var f=b(l);s.l(f),f.forEach(d),u.forEach(d),this.h()},h(){E(l,"class","w-30 mt-2 rounded border border-neutral-300 text-center"),E(e,"class","flex flex-row justify-center")},m(o,u){y(o,e,u),p(e,l),a[t].m(l,null),c=!0},p(o,u){let f=t;t=r(o),t===f?a[t].p(o,u):(J(),N(a[f],1,1,()=>{a[f]=null}),x(),s=a[t],s?s.p(o,u):(s=a[t]=n[t](o),s.c()),S(s,1),s.m(l,null))},i(o){c||(S(s),c=!0)},o(o){N(s),c=!1},d(o){o&&d(e),a[t].d()}}}function al(i){let e,l;return e=new lt({props:{size:"small",class:"w-full",kind:"ghost",icon:zt,$$slots:{default:[rl]},$$scope:{ctx:i}}}),e.$on("click",i[33]),{c(){ie(e.$$.fragment)},l(t){ne(e.$$.fragment,t)},m(t,s){se(e,t,s),l=!0},p(t,s){const c={};s[1]&256&&(c.$$scope={dirty:s,ctx:t}),e.$set(c)},i(t){l||(S(e.$$.fragment,t),l=!0)},o(t){N(e.$$.fragment,t),l=!1},d(t){ae(e,t)}}}function ol(i){let e,l;return e=new lt({props:{size:"small",class:"w-full",kind:"ghost",icon:Bt,$$slots:{default:[cl]},$$scope:{ctx:i}}}),e.$on("click",i[32]),{c(){ie(e.$$.fragment)},l(t){ne(e.$$.fragment,t)},m(t,s){se(e,t,s),l=!0},p(t,s){const c={};s[1]&256&&(c.$$scope={dirty:s,ctx:t}),e.$set(c)},i(t){l||(S(e.$$.fragment,t),l=!0)},o(t){N(e.$$.fragment,t),l=!1},d(t){ae(e,t)}}}function rl(i){let e;return{c(){e=M("Hide excess")},l(l){e=I(l,"Hide excess")},m(l,t){y(l,e,t)},d(l){l&&d(e)}}}function cl(i){let e;return{c(){e=M("Show all")},l(l){e=I(l,"Show all")},m(l,t){y(l,e,t)},d(l){l&&d(e)}}}function ul(i){let e,l,t,s=i[6],c=[];for(let r=0;r<s.length;r+=1)c[r]=Xe(We(i,s,r));const n=r=>N(c[r],1,1,()=>{c[r]=null});let a=(i[5]||i[4])&&Ge(i);return{c(){e=H("div");for(let r=0;r<c.length;r+=1)c[r].c();l=Q(),a&&a.c(),this.h()},l(r){e=P(r,"DIV",{class:!0});var o=b(e);for(let u=0;u<c.length;u+=1)c[u].l(o);l=Z(o),a&&a.l(o),o.forEach(d),this.h()},h(){E(e,"class","relative overflow-x-hidden text-ellipsis whitespace-break-spaces")},m(r,o){y(r,e,o);for(let u=0;u<c.length;u+=1)c[u]&&c[u].m(e,null);p(e,l),a&&a.m(e,null),t=!0},p(r,o){if(o[0]&220623){s=r[6];let u;for(u=0;u<s.length;u+=1){const f=We(r,s,u);c[u]?(c[u].p(f,o),S(c[u],1)):(c[u]=Xe(f),c[u].c(),S(c[u],1),c[u].m(e,l))}for(J(),u=s.length;u<c.length;u+=1)n(u);x()}r[5]||r[4]?a?(a.p(r,o),o[0]&48&&S(a,1)):(a=Ge(r),a.c(),S(a,1),a.m(e,null)):a&&(J(),N(a,1,1,()=>{a=null}),x())},i(r){if(!t){for(let o=0;o<s.length;o+=1)S(c[o]);S(a),t=!0}},o(r){c=c.filter(Boolean);for(let o=0;o<c.length;o+=1)N(c[o]);N(a),t=!1},d(r){r&&d(e),gt(c,r),a&&a.d()}}}const Ke=.9,Qe=()=>null;function fl(i,e,l){let t,s,c,n,a,r,o,{text:u}=e,{row:f}=e,{field:m=void 0}=e,{spanPaths:g}=e,{path:v=void 0}=e,{valuePaths:_}=e,{markdown:k=!1}=e,{embeddings:w}=e,{datasetViewStore:C=void 0}=e;const L=kt();we(i,L,h=>l(8,o=h));let D,B={},T=new Set;const le=h=>{h.paths.forEach(V=>T.add(V)),l(3,T)},X=h=>{h.paths.forEach(V=>T.delete(V)),l(3,T)};let Y={};const ge=h=>{const ce={conceptName:null,conceptNamespace:null,text:s.filter(ue=>ue.paths.some(ke=>((h==null?void 0:h.paths)||[]).some(fe=>tt(fe,ke)))).map(ue=>ue.text).join("")};for(const ue of Object.keys(h.originalSpans)){const ke=(B[ue]||[]).filter(fe=>fe.type==="concept_score");for(const fe of ke){const Ne=fe.signal;ce.conceptName=Ne.concept_name,ce.conceptNamespace=Ne.namespace;break}}return ce},_e=wt();we(i,_e,h=>l(34,a=h));const ve=(h,V,pe,ce)=>{if(!V||!h)throw Error("Label could not be added, no active concept.");a.mutate([h,V,{insert:[{text:pe,label:ce}]}])};let G=!1,re=_t(Et);we(i,re,h=>l(7,r=h));const it=(h,V)=>{C==null||m==null||C.addSearch({path:m.path,type:"semantic",query:V,embedding:h})},nt=Ht(),st=h=>ge(h),at=h=>le(h),ot=h=>X(h),rt=()=>l(4,G=!0),ct=()=>l(4,G=!1);return i.$$set=h=>{"text"in h&&l(18,u=h.text),"row"in h&&l(19,f=h.row),"field"in h&&l(20,m=h.field),"spanPaths"in h&&l(0,g=h.spanPaths),"path"in h&&l(21,v=h.path),"valuePaths"in h&&l(22,_=h.valuePaths),"markdown"in h&&l(1,k=h.markdown),"embeddings"in h&&l(2,w=h.embeddings),"datasetViewStore"in h&&l(23,C=h.datasetViewStore)},i.$$.update=()=>{if(i.$$.dirty[0]&2621441&&(l(24,D={}),g.forEach(h=>{const V=St(f,h);l(24,D[Se(h)]=V.filter(pe=>yt(oe.path(pe),v)||v==null),D)})),i.$$.dirty[0]&37748736){l(25,B={});for(const h of _){const V=Se(h.spanPath);B[V]==null&&l(25,B[V]=[],B),B[V].push(h)}}if(i.$$.dirty[0]&17039360&&l(28,t=Nt(u,D)),i.$$.dirty[0]&301989896&&l(27,s=$t(t,B,T)),i.$$.dirty[0]&335544320){l(26,Y={});for(const h of t)for(const V of h.paths)l(26,Y[V]=Y[V]||[],Y),Y[V].push(h)}i.$$.dirty[0]&134217744&&l(6,{snippetSpans:c,someSnippetsHidden:n}=el(s,G),c,(l(5,n),l(27,s),l(4,G),l(28,t),l(25,B),l(3,T),l(18,u),l(24,D),l(22,_),l(0,g),l(19,f),l(21,v)))},[g,k,w,T,G,n,c,r,o,L,le,X,ge,_e,ve,re,it,nt,u,f,m,v,_,C,D,B,Y,s,t,st,at,ot,rt,ct]}class _l extends ${constructor(e){super(),ee(this,e,fl,ul,te,{text:18,row:19,field:20,spanPaths:0,path:21,valuePaths:22,markdown:1,embeddings:2,datasetViewStore:23},null,[-1,-1])}}export{qt as E,_l as S,Ot as T,At as a,Ut as c};
