{"version":3,"file":"integrationConfig.js","names":["$","$accessToken","$workspace","$error","insertAfter","hide","selectize","create","dropdownParent","searchField","valueField","labelField","render","option","item","escape","concat","name","onChange","value","val","options","$control","width","disable","showError","errorStr","html","_","show","lastKey","changeWorkspaceEnabled","throttle","apiKey","trim","length","load","callback","params","param","api_key","ajax","url","SITE_ROOT","type","success","res","result","enable","data","error","console","xhr","textStatus","errorThrown","on"],"sources":["../../../../../../rbintegrations/static/js/asana/integrationConfig.es6.js"],"sourcesContent":["$(function() {\n    const $accessToken = $('#id_asana_access_token');\n    const $workspace = $('#id_asana_workspace');\n    const $error = $('<div class=\"errorlist\">')\n        .insertAfter($accessToken)\n        .hide();\n\n    $workspace.selectize({\n        create: false,\n        dropdownParent: 'body',\n        searchField: 'name',\n        valueField: 'id',\n        labelField: 'name',\n        render: {\n            option(item, escape) {\n                return `<div>${escape(item.name)}</div>`;\n            },\n        },\n        onChange(value) {\n            $('#id_asana_workspace_name').val(this.options[value].name);\n        },\n    });\n\n    const selectize = $workspace[0].selectize;\n    selectize.$control.width($('#id_name').width());\n    selectize.disable();\n\n    function showError(errorStr) {\n        $error\n            .html(dedent`\n                <span class=\"rb-icon rb-icon-warning\"></span>\n                ${_.escape(errorStr)}\n            `)\n            .show();\n    }\n\n    let lastKey = null;\n\n    const changeWorkspaceEnabled = _.throttle(() => {\n        const apiKey = $accessToken.val().trim();\n\n        if (lastKey === apiKey) {\n            return;\n        }\n\n        lastKey = apiKey;\n        $error.hide();\n        selectize.disable();\n\n        if (apiKey.length === 0) {\n            return;\n        }\n\n        selectize.load(callback => {\n            const params = $.param({ api_key: apiKey });\n\n            $.ajax({\n                url: `${SITE_ROOT}rbintegrations/asana/workspaces/?${params}`,\n                type: 'GET',\n                success(res) {\n                    if (res.result === 'success') {\n                        selectize.enable();\n                        callback(res.data);\n                    } else if (res.result === 'error') {\n                        showError(res.error);\n                        callback();\n                    } else {\n                        console.error('Unexpected error when fetching ' +\n                                      'Asana workspace list',\n                                      res);\n                        showError('Unable to communicate with Asana');\n                        callback();\n                    }\n                },\n                error(xhr, textStatus, errorThrown) {\n                    console.error('Unexpected error when fetching ' +\n                                  'Asana workspace list',\n                                  xhr);\n                    showError('Unable to communicate with Asana');\n                    callback();\n                },\n            });\n        });\n    }, 100);\n\n    $accessToken.on('change keyup', changeWorkspaceEnabled);\n    changeWorkspaceEnabled();\n});\n"],"mappings":"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"}