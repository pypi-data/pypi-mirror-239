"use strict";
(self["webpackChunk_jupyterlab_application_top"] = self["webpackChunk_jupyterlab_application_top"] || []).push([["vendors-node_modules_codemirror_legacy-modes_mode_textile_js"],{

/***/ "../node_modules/@codemirror/legacy-modes/mode/textile.js":
/*!****************************************************************!*\
  !*** ../node_modules/@codemirror/legacy-modes/mode/textile.js ***!
  \****************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

__webpack_require__.r(__webpack_exports__);
/* harmony export */ __webpack_require__.d(__webpack_exports__, {
/* harmony export */   "textile": () => (/* binding */ textile)
/* harmony export */ });
var TOKEN_STYLES = {
  addition: "inserted",
  attributes: "propertyName",
  bold: "strong",
  cite: "keyword",
  code: "monospace",
  definitionList: "list",
  deletion: "deleted",
  div: "punctuation",
  em: "emphasis",
  footnote: "variable",
  footCite: "qualifier",
  header: "heading",
  html: "comment",
  image: "atom",
  italic: "emphasis",
  link: "link",
  linkDefinition: "link",
  list1: "list",
  list2: "list.special",
  list3: "list",
  notextile: "string.special",
  pre: "operator",
  p: "content",
  quote: "bracket",
  span: "quote",
  specialChar: "character",
  strong: "strong",
  sub: "content.special",
  sup: "content.special",
  table: "variableName.special",
  tableHeading: "operator"
};

function startNewLine(stream, state) {
  state.mode = Modes.newLayout;
  state.tableHeading = false;

  if (state.layoutType === "definitionList" && state.spanningLayout &&
      stream.match(RE("definitionListEnd"), false))
    state.spanningLayout = false;
}

function handlePhraseModifier(stream, state, ch) {
  if (ch === "_") {
    if (stream.eat("_"))
      return togglePhraseModifier(stream, state, "italic", /__/, 2);
    else
      return togglePhraseModifier(stream, state, "em", /_/, 1);
  }

  if (ch === "*") {
    if (stream.eat("*")) {
      return togglePhraseModifier(stream, state, "bold", /\*\*/, 2);
    }
    return togglePhraseModifier(stream, state, "strong", /\*/, 1);
  }

  if (ch === "[") {
    if (stream.match(/\d+\]/)) state.footCite = true;
    return tokenStyles(state);
  }

  if (ch === "(") {
    var spec = stream.match(/^(r|tm|c)\)/);
    if (spec)
      return TOKEN_STYLES.specialChar
  }

  if (ch === "<" && stream.match(/(\w+)[^>]+>[^<]+<\/\1>/))
    return TOKEN_STYLES.html

  if (ch === "?" && stream.eat("?"))
    return togglePhraseModifier(stream, state, "cite", /\?\?/, 2);

  if (ch === "=" && stream.eat("="))
    return togglePhraseModifier(stream, state, "notextile", /==/, 2);

  if (ch === "-" && !stream.eat("-"))
    return togglePhraseModifier(stream, state, "deletion", /-/, 1);

  if (ch === "+")
    return togglePhraseModifier(stream, state, "addition", /\+/, 1);

  if (ch === "~")
    return togglePhraseModifier(stream, state, "sub", /~/, 1);

  if (ch === "^")
    return togglePhraseModifier(stream, state, "sup", /\^/, 1);

  if (ch === "%")
    return togglePhraseModifier(stream, state, "span", /%/, 1);

  if (ch === "@")
    return togglePhraseModifier(stream, state, "code", /@/, 1);

  if (ch === "!") {
    var type = togglePhraseModifier(stream, state, "image", /(?:\([^\)]+\))?!/, 1);
    stream.match(/^:\S+/); // optional Url portion
    return type;
  }
  return tokenStyles(state);
}

function togglePhraseModifier(stream, state, phraseModifier, closeRE, openSize) {
  var charBefore = stream.pos > openSize ? stream.string.charAt(stream.pos - openSize - 1) : null;
  var charAfter = stream.peek();
  if (state[phraseModifier]) {
    if ((!charAfter || /\W/.test(charAfter)) && charBefore && /\S/.test(charBefore)) {
      var type = tokenStyles(state);
      state[phraseModifier] = false;
      return type;
    }
  } else if ((!charBefore || /\W/.test(charBefore)) && charAfter && /\S/.test(charAfter) &&
             stream.match(new RegExp("^.*\\S" + closeRE.source + "(?:\\W|$)"), false)) {
    state[phraseModifier] = true;
    state.mode = Modes.attributes;
  }
  return tokenStyles(state);
};

function tokenStyles(state) {
  var disabled = textileDisabled(state);
  if (disabled) return disabled;

  var styles = [];
  if (state.layoutType) styles.push(TOKEN_STYLES[state.layoutType]);

  styles = styles.concat(activeStyles(
    state, "addition", "bold", "cite", "code", "deletion", "em", "footCite",
    "image", "italic", "link", "span", "strong", "sub", "sup", "table", "tableHeading"));

  if (state.layoutType === "header")
    styles.push(TOKEN_STYLES.header + "-" + state.header);

  return styles.length ? styles.join(" ") : null;
}

function textileDisabled(state) {
  var type = state.layoutType;

  switch(type) {
  case "notextile":
  case "code":
  case "pre":
    return TOKEN_STYLES[type];
  default:
    if (state.notextile)
      return TOKEN_STYLES.notextile + (type ? (" " + TOKEN_STYLES[type]) : "");
    return null;
  }
}

function activeStyles(state) {
  var styles = [];
  for (var i = 1; i < arguments.length; ++i) {
    if (state[arguments[i]])
      styles.push(TOKEN_STYLES[arguments[i]]);
  }
  return styles;
}

function blankLine(state) {
  var spanningLayout = state.spanningLayout, type = state.layoutType;

  for (var key in state) if (state.hasOwnProperty(key))
    delete state[key];

  state.mode = Modes.newLayout;
  if (spanningLayout) {
    state.layoutType = type;
    state.spanningLayout = true;
  }
}

var REs = {
  cache: {},
  single: {
    bc: "bc",
    bq: "bq",
    definitionList: /- .*?:=+/,
    definitionListEnd: /.*=:\s*$/,
    div: "div",
    drawTable: /\|.*\|/,
    foot: /fn\d+/,
    header: /h[1-6]/,
    html: /\s*<(?:\/)?(\w+)(?:[^>]+)?>(?:[^<]+<\/\1>)?/,
    link: /[^"]+":\S/,
    linkDefinition: /\[[^\s\]]+\]\S+/,
    list: /(?:#+|\*+)/,
    notextile: "notextile",
    para: "p",
    pre: "pre",
    table: "table",
    tableCellAttributes: /[\/\\]\d+/,
    tableHeading: /\|_\./,
    tableText: /[^"_\*\[\(\?\+~\^%@|-]+/,
    text: /[^!"_=\*\[\(<\?\+~\^%@-]+/
  },
  attributes: {
    align: /(?:<>|<|>|=)/,
    selector: /\([^\(][^\)]+\)/,
    lang: /\[[^\[\]]+\]/,
    pad: /(?:\(+|\)+){1,2}/,
    css: /\{[^\}]+\}/
  },
  createRe: function(name) {
    switch (name) {
    case "drawTable":
      return REs.makeRe("^", REs.single.drawTable, "$");
    case "html":
      return REs.makeRe("^", REs.single.html, "(?:", REs.single.html, ")*", "$");
    case "linkDefinition":
      return REs.makeRe("^", REs.single.linkDefinition, "$");
    case "listLayout":
      return REs.makeRe("^", REs.single.list, RE("allAttributes"), "*\\s+");
    case "tableCellAttributes":
      return REs.makeRe("^", REs.choiceRe(REs.single.tableCellAttributes,
                                          RE("allAttributes")), "+\\.");
    case "type":
      return REs.makeRe("^", RE("allTypes"));
    case "typeLayout":
      return REs.makeRe("^", RE("allTypes"), RE("allAttributes"),
                        "*\\.\\.?", "(\\s+|$)");
    case "attributes":
      return REs.makeRe("^", RE("allAttributes"), "+");

    case "allTypes":
      return REs.choiceRe(REs.single.div, REs.single.foot,
                          REs.single.header, REs.single.bc, REs.single.bq,
                          REs.single.notextile, REs.single.pre, REs.single.table,
                          REs.single.para);

    case "allAttributes":
      return REs.choiceRe(REs.attributes.selector, REs.attributes.css,
                          REs.attributes.lang, REs.attributes.align, REs.attributes.pad);

    default:
      return REs.makeRe("^", REs.single[name]);
    }
  },
  makeRe: function() {
    var pattern = "";
    for (var i = 0; i < arguments.length; ++i) {
      var arg = arguments[i];
      pattern += (typeof arg === "string") ? arg : arg.source;
    }
    return new RegExp(pattern);
  },
  choiceRe: function() {
    var parts = [arguments[0]];
    for (var i = 1; i < arguments.length; ++i) {
      parts[i * 2 - 1] = "|";
      parts[i * 2] = arguments[i];
    }

    parts.unshift("(?:");
    parts.push(")");
    return REs.makeRe.apply(null, parts);
  }
};

function RE(name) {
  return (REs.cache[name] || (REs.cache[name] = REs.createRe(name)));
}

var Modes = {
  newLayout: function(stream, state) {
    if (stream.match(RE("typeLayout"), false)) {
      state.spanningLayout = false;
      return (state.mode = Modes.blockType)(stream, state);
    }
    var newMode;
    if (!textileDisabled(state)) {
      if (stream.match(RE("listLayout"), false))
        newMode = Modes.list;
      else if (stream.match(RE("drawTable"), false))
        newMode = Modes.table;
      else if (stream.match(RE("linkDefinition"), false))
        newMode = Modes.linkDefinition;
      else if (stream.match(RE("definitionList")))
        newMode = Modes.definitionList;
      else if (stream.match(RE("html"), false))
        newMode = Modes.html;
    }
    return (state.mode = (newMode || Modes.text))(stream, state);
  },

  blockType: function(stream, state) {
    var match, type;
    state.layoutType = null;

    if (match = stream.match(RE("type")))
      type = match[0];
    else
      return (state.mode = Modes.text)(stream, state);

    if (match = type.match(RE("header"))) {
      state.layoutType = "header";
      state.header = parseInt(match[0][1]);
    } else if (type.match(RE("bq"))) {
      state.layoutType = "quote";
    } else if (type.match(RE("bc"))) {
      state.layoutType = "code";
    } else if (type.match(RE("foot"))) {
      state.layoutType = "footnote";
    } else if (type.match(RE("notextile"))) {
      state.layoutType = "notextile";
    } else if (type.match(RE("pre"))) {
      state.layoutType = "pre";
    } else if (type.match(RE("div"))) {
      state.layoutType = "div";
    } else if (type.match(RE("table"))) {
      state.layoutType = "table";
    }

    state.mode = Modes.attributes;
    return tokenStyles(state);
  },

  text: function(stream, state) {
    if (stream.match(RE("text"))) return tokenStyles(state);

    var ch = stream.next();
    if (ch === '"')
      return (state.mode = Modes.link)(stream, state);
    return handlePhraseModifier(stream, state, ch);
  },

  attributes: function(stream, state) {
    state.mode = Modes.layoutLength;

    if (stream.match(RE("attributes")))
      return TOKEN_STYLES.attributes
    else
      return tokenStyles(state);
  },

  layoutLength: function(stream, state) {
    if (stream.eat(".") && stream.eat("."))
      state.spanningLayout = true;

    state.mode = Modes.text;
    return tokenStyles(state);
  },

  list: function(stream, state) {
    var match = stream.match(RE("list"));
    state.listDepth = match[0].length;
    var listMod = (state.listDepth - 1) % 3;
    if (!listMod)
      state.layoutType = "list1";
    else if (listMod === 1)
      state.layoutType = "list2";
    else
      state.layoutType = "list3";

    state.mode = Modes.attributes;
    return tokenStyles(state);
  },

  link: function(stream, state) {
    state.mode = Modes.text;
    if (stream.match(RE("link"))) {
      stream.match(/\S+/);
      return TOKEN_STYLES.link
    }
    return tokenStyles(state);
  },

  linkDefinition: function(stream) {
    stream.skipToEnd();
    return TOKEN_STYLES.linkDefinition
  },

  definitionList: function(stream, state) {
    stream.match(RE("definitionList"));

    state.layoutType = "definitionList";

    if (stream.match(/\s*$/))
      state.spanningLayout = true;
    else
      state.mode = Modes.attributes;

    return tokenStyles(state);
  },

  html: function(stream) {
    stream.skipToEnd();
    return TOKEN_STYLES.html
  },

  table: function(stream, state) {
    state.layoutType = "table";
    return (state.mode = Modes.tableCell)(stream, state);
  },

  tableCell: function(stream, state) {
    if (stream.match(RE("tableHeading")))
      state.tableHeading = true;
    else
      stream.eat("|");

    state.mode = Modes.tableCellAttributes;
    return tokenStyles(state);
  },

  tableCellAttributes: function(stream, state) {
    state.mode = Modes.tableText;

    if (stream.match(RE("tableCellAttributes")))
      return TOKEN_STYLES.attributes
    else
      return tokenStyles(state);
  },

  tableText: function(stream, state) {
    if (stream.match(RE("tableText")))
      return tokenStyles(state);

    if (stream.peek() === "|") { // end of cell
      state.mode = Modes.tableCell;
      return tokenStyles(state);
    }
    return handlePhraseModifier(stream, state, stream.next());
  }
};

const textile = {
  name: "textile",
  startState: function() {
    return { mode: Modes.newLayout };
  },
  token: function(stream, state) {
    if (stream.sol()) startNewLine(stream, state);
    return state.mode(stream, state);
  },
  blankLine: blankLine
};


/***/ })

}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVuZG9ycy1ub2RlX21vZHVsZXNfY29kZW1pcnJvcl9sZWdhY3ktbW9kZXNfbW9kZV90ZXh0aWxlX2pzLjBmNTY5OGEzYTIzNmNjNjc5YjlmLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSwyQkFBMkI7QUFDM0I7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsSUFBSTtBQUNKO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0Esa0JBQWtCLHNCQUFzQjtBQUN4QztBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7O0FBRUE7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxXQUFXO0FBQ1g7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0Esc0JBQXNCLElBQUk7QUFDMUIsWUFBWSxJQUFJLElBQUk7QUFDcEIsR0FBRztBQUNIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxvQkFBb0Isc0JBQXNCO0FBQzFDO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0E7QUFDQSxvQkFBb0Isc0JBQXNCO0FBQzFDO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0EsTUFBTTtBQUNOO0FBQ0E7O0FBRUE7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTs7QUFFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7O0FBRUE7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTtBQUNBLEdBQUc7O0FBRUg7QUFDQTtBQUNBO0FBQ0EsR0FBRzs7QUFFSDtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7O0FBRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQSxHQUFHOztBQUVIO0FBQ0E7QUFDQTs7QUFFQSxpQ0FBaUM7QUFDakM7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQUVPO0FBQ1A7QUFDQTtBQUNBLGFBQWE7QUFDYixHQUFHO0FBQ0g7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNIO0FBQ0EiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9AanVweXRlcmxhYi9hcHBsaWNhdGlvbi10b3AvLi4vbm9kZV9tb2R1bGVzL0Bjb2RlbWlycm9yL2xlZ2FjeS1tb2Rlcy9tb2RlL3RleHRpbGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsidmFyIFRPS0VOX1NUWUxFUyA9IHtcbiAgYWRkaXRpb246IFwiaW5zZXJ0ZWRcIixcbiAgYXR0cmlidXRlczogXCJwcm9wZXJ0eU5hbWVcIixcbiAgYm9sZDogXCJzdHJvbmdcIixcbiAgY2l0ZTogXCJrZXl3b3JkXCIsXG4gIGNvZGU6IFwibW9ub3NwYWNlXCIsXG4gIGRlZmluaXRpb25MaXN0OiBcImxpc3RcIixcbiAgZGVsZXRpb246IFwiZGVsZXRlZFwiLFxuICBkaXY6IFwicHVuY3R1YXRpb25cIixcbiAgZW06IFwiZW1waGFzaXNcIixcbiAgZm9vdG5vdGU6IFwidmFyaWFibGVcIixcbiAgZm9vdENpdGU6IFwicXVhbGlmaWVyXCIsXG4gIGhlYWRlcjogXCJoZWFkaW5nXCIsXG4gIGh0bWw6IFwiY29tbWVudFwiLFxuICBpbWFnZTogXCJhdG9tXCIsXG4gIGl0YWxpYzogXCJlbXBoYXNpc1wiLFxuICBsaW5rOiBcImxpbmtcIixcbiAgbGlua0RlZmluaXRpb246IFwibGlua1wiLFxuICBsaXN0MTogXCJsaXN0XCIsXG4gIGxpc3QyOiBcImxpc3Quc3BlY2lhbFwiLFxuICBsaXN0MzogXCJsaXN0XCIsXG4gIG5vdGV4dGlsZTogXCJzdHJpbmcuc3BlY2lhbFwiLFxuICBwcmU6IFwib3BlcmF0b3JcIixcbiAgcDogXCJjb250ZW50XCIsXG4gIHF1b3RlOiBcImJyYWNrZXRcIixcbiAgc3BhbjogXCJxdW90ZVwiLFxuICBzcGVjaWFsQ2hhcjogXCJjaGFyYWN0ZXJcIixcbiAgc3Ryb25nOiBcInN0cm9uZ1wiLFxuICBzdWI6IFwiY29udGVudC5zcGVjaWFsXCIsXG4gIHN1cDogXCJjb250ZW50LnNwZWNpYWxcIixcbiAgdGFibGU6IFwidmFyaWFibGVOYW1lLnNwZWNpYWxcIixcbiAgdGFibGVIZWFkaW5nOiBcIm9wZXJhdG9yXCJcbn07XG5cbmZ1bmN0aW9uIHN0YXJ0TmV3TGluZShzdHJlYW0sIHN0YXRlKSB7XG4gIHN0YXRlLm1vZGUgPSBNb2Rlcy5uZXdMYXlvdXQ7XG4gIHN0YXRlLnRhYmxlSGVhZGluZyA9IGZhbHNlO1xuXG4gIGlmIChzdGF0ZS5sYXlvdXRUeXBlID09PSBcImRlZmluaXRpb25MaXN0XCIgJiYgc3RhdGUuc3Bhbm5pbmdMYXlvdXQgJiZcbiAgICAgIHN0cmVhbS5tYXRjaChSRShcImRlZmluaXRpb25MaXN0RW5kXCIpLCBmYWxzZSkpXG4gICAgc3RhdGUuc3Bhbm5pbmdMYXlvdXQgPSBmYWxzZTtcbn1cblxuZnVuY3Rpb24gaGFuZGxlUGhyYXNlTW9kaWZpZXIoc3RyZWFtLCBzdGF0ZSwgY2gpIHtcbiAgaWYgKGNoID09PSBcIl9cIikge1xuICAgIGlmIChzdHJlYW0uZWF0KFwiX1wiKSlcbiAgICAgIHJldHVybiB0b2dnbGVQaHJhc2VNb2RpZmllcihzdHJlYW0sIHN0YXRlLCBcIml0YWxpY1wiLCAvX18vLCAyKTtcbiAgICBlbHNlXG4gICAgICByZXR1cm4gdG9nZ2xlUGhyYXNlTW9kaWZpZXIoc3RyZWFtLCBzdGF0ZSwgXCJlbVwiLCAvXy8sIDEpO1xuICB9XG5cbiAgaWYgKGNoID09PSBcIipcIikge1xuICAgIGlmIChzdHJlYW0uZWF0KFwiKlwiKSkge1xuICAgICAgcmV0dXJuIHRvZ2dsZVBocmFzZU1vZGlmaWVyKHN0cmVhbSwgc3RhdGUsIFwiYm9sZFwiLCAvXFwqXFwqLywgMik7XG4gICAgfVxuICAgIHJldHVybiB0b2dnbGVQaHJhc2VNb2RpZmllcihzdHJlYW0sIHN0YXRlLCBcInN0cm9uZ1wiLCAvXFwqLywgMSk7XG4gIH1cblxuICBpZiAoY2ggPT09IFwiW1wiKSB7XG4gICAgaWYgKHN0cmVhbS5tYXRjaCgvXFxkK1xcXS8pKSBzdGF0ZS5mb290Q2l0ZSA9IHRydWU7XG4gICAgcmV0dXJuIHRva2VuU3R5bGVzKHN0YXRlKTtcbiAgfVxuXG4gIGlmIChjaCA9PT0gXCIoXCIpIHtcbiAgICB2YXIgc3BlYyA9IHN0cmVhbS5tYXRjaCgvXihyfHRtfGMpXFwpLyk7XG4gICAgaWYgKHNwZWMpXG4gICAgICByZXR1cm4gVE9LRU5fU1RZTEVTLnNwZWNpYWxDaGFyXG4gIH1cblxuICBpZiAoY2ggPT09IFwiPFwiICYmIHN0cmVhbS5tYXRjaCgvKFxcdyspW14+XSs+W148XSs8XFwvXFwxPi8pKVxuICAgIHJldHVybiBUT0tFTl9TVFlMRVMuaHRtbFxuXG4gIGlmIChjaCA9PT0gXCI/XCIgJiYgc3RyZWFtLmVhdChcIj9cIikpXG4gICAgcmV0dXJuIHRvZ2dsZVBocmFzZU1vZGlmaWVyKHN0cmVhbSwgc3RhdGUsIFwiY2l0ZVwiLCAvXFw/XFw/LywgMik7XG5cbiAgaWYgKGNoID09PSBcIj1cIiAmJiBzdHJlYW0uZWF0KFwiPVwiKSlcbiAgICByZXR1cm4gdG9nZ2xlUGhyYXNlTW9kaWZpZXIoc3RyZWFtLCBzdGF0ZSwgXCJub3RleHRpbGVcIiwgLz09LywgMik7XG5cbiAgaWYgKGNoID09PSBcIi1cIiAmJiAhc3RyZWFtLmVhdChcIi1cIikpXG4gICAgcmV0dXJuIHRvZ2dsZVBocmFzZU1vZGlmaWVyKHN0cmVhbSwgc3RhdGUsIFwiZGVsZXRpb25cIiwgLy0vLCAxKTtcblxuICBpZiAoY2ggPT09IFwiK1wiKVxuICAgIHJldHVybiB0b2dnbGVQaHJhc2VNb2RpZmllcihzdHJlYW0sIHN0YXRlLCBcImFkZGl0aW9uXCIsIC9cXCsvLCAxKTtcblxuICBpZiAoY2ggPT09IFwiflwiKVxuICAgIHJldHVybiB0b2dnbGVQaHJhc2VNb2RpZmllcihzdHJlYW0sIHN0YXRlLCBcInN1YlwiLCAvfi8sIDEpO1xuXG4gIGlmIChjaCA9PT0gXCJeXCIpXG4gICAgcmV0dXJuIHRvZ2dsZVBocmFzZU1vZGlmaWVyKHN0cmVhbSwgc3RhdGUsIFwic3VwXCIsIC9cXF4vLCAxKTtcblxuICBpZiAoY2ggPT09IFwiJVwiKVxuICAgIHJldHVybiB0b2dnbGVQaHJhc2VNb2RpZmllcihzdHJlYW0sIHN0YXRlLCBcInNwYW5cIiwgLyUvLCAxKTtcblxuICBpZiAoY2ggPT09IFwiQFwiKVxuICAgIHJldHVybiB0b2dnbGVQaHJhc2VNb2RpZmllcihzdHJlYW0sIHN0YXRlLCBcImNvZGVcIiwgL0AvLCAxKTtcblxuICBpZiAoY2ggPT09IFwiIVwiKSB7XG4gICAgdmFyIHR5cGUgPSB0b2dnbGVQaHJhc2VNb2RpZmllcihzdHJlYW0sIHN0YXRlLCBcImltYWdlXCIsIC8oPzpcXChbXlxcKV0rXFwpKT8hLywgMSk7XG4gICAgc3RyZWFtLm1hdGNoKC9eOlxcUysvKTsgLy8gb3B0aW9uYWwgVXJsIHBvcnRpb25cbiAgICByZXR1cm4gdHlwZTtcbiAgfVxuICByZXR1cm4gdG9rZW5TdHlsZXMoc3RhdGUpO1xufVxuXG5mdW5jdGlvbiB0b2dnbGVQaHJhc2VNb2RpZmllcihzdHJlYW0sIHN0YXRlLCBwaHJhc2VNb2RpZmllciwgY2xvc2VSRSwgb3BlblNpemUpIHtcbiAgdmFyIGNoYXJCZWZvcmUgPSBzdHJlYW0ucG9zID4gb3BlblNpemUgPyBzdHJlYW0uc3RyaW5nLmNoYXJBdChzdHJlYW0ucG9zIC0gb3BlblNpemUgLSAxKSA6IG51bGw7XG4gIHZhciBjaGFyQWZ0ZXIgPSBzdHJlYW0ucGVlaygpO1xuICBpZiAoc3RhdGVbcGhyYXNlTW9kaWZpZXJdKSB7XG4gICAgaWYgKCghY2hhckFmdGVyIHx8IC9cXFcvLnRlc3QoY2hhckFmdGVyKSkgJiYgY2hhckJlZm9yZSAmJiAvXFxTLy50ZXN0KGNoYXJCZWZvcmUpKSB7XG4gICAgICB2YXIgdHlwZSA9IHRva2VuU3R5bGVzKHN0YXRlKTtcbiAgICAgIHN0YXRlW3BocmFzZU1vZGlmaWVyXSA9IGZhbHNlO1xuICAgICAgcmV0dXJuIHR5cGU7XG4gICAgfVxuICB9IGVsc2UgaWYgKCghY2hhckJlZm9yZSB8fCAvXFxXLy50ZXN0KGNoYXJCZWZvcmUpKSAmJiBjaGFyQWZ0ZXIgJiYgL1xcUy8udGVzdChjaGFyQWZ0ZXIpICYmXG4gICAgICAgICAgICAgc3RyZWFtLm1hdGNoKG5ldyBSZWdFeHAoXCJeLipcXFxcU1wiICsgY2xvc2VSRS5zb3VyY2UgKyBcIig/OlxcXFxXfCQpXCIpLCBmYWxzZSkpIHtcbiAgICBzdGF0ZVtwaHJhc2VNb2RpZmllcl0gPSB0cnVlO1xuICAgIHN0YXRlLm1vZGUgPSBNb2Rlcy5hdHRyaWJ1dGVzO1xuICB9XG4gIHJldHVybiB0b2tlblN0eWxlcyhzdGF0ZSk7XG59O1xuXG5mdW5jdGlvbiB0b2tlblN0eWxlcyhzdGF0ZSkge1xuICB2YXIgZGlzYWJsZWQgPSB0ZXh0aWxlRGlzYWJsZWQoc3RhdGUpO1xuICBpZiAoZGlzYWJsZWQpIHJldHVybiBkaXNhYmxlZDtcblxuICB2YXIgc3R5bGVzID0gW107XG4gIGlmIChzdGF0ZS5sYXlvdXRUeXBlKSBzdHlsZXMucHVzaChUT0tFTl9TVFlMRVNbc3RhdGUubGF5b3V0VHlwZV0pO1xuXG4gIHN0eWxlcyA9IHN0eWxlcy5jb25jYXQoYWN0aXZlU3R5bGVzKFxuICAgIHN0YXRlLCBcImFkZGl0aW9uXCIsIFwiYm9sZFwiLCBcImNpdGVcIiwgXCJjb2RlXCIsIFwiZGVsZXRpb25cIiwgXCJlbVwiLCBcImZvb3RDaXRlXCIsXG4gICAgXCJpbWFnZVwiLCBcIml0YWxpY1wiLCBcImxpbmtcIiwgXCJzcGFuXCIsIFwic3Ryb25nXCIsIFwic3ViXCIsIFwic3VwXCIsIFwidGFibGVcIiwgXCJ0YWJsZUhlYWRpbmdcIikpO1xuXG4gIGlmIChzdGF0ZS5sYXlvdXRUeXBlID09PSBcImhlYWRlclwiKVxuICAgIHN0eWxlcy5wdXNoKFRPS0VOX1NUWUxFUy5oZWFkZXIgKyBcIi1cIiArIHN0YXRlLmhlYWRlcik7XG5cbiAgcmV0dXJuIHN0eWxlcy5sZW5ndGggPyBzdHlsZXMuam9pbihcIiBcIikgOiBudWxsO1xufVxuXG5mdW5jdGlvbiB0ZXh0aWxlRGlzYWJsZWQoc3RhdGUpIHtcbiAgdmFyIHR5cGUgPSBzdGF0ZS5sYXlvdXRUeXBlO1xuXG4gIHN3aXRjaCh0eXBlKSB7XG4gIGNhc2UgXCJub3RleHRpbGVcIjpcbiAgY2FzZSBcImNvZGVcIjpcbiAgY2FzZSBcInByZVwiOlxuICAgIHJldHVybiBUT0tFTl9TVFlMRVNbdHlwZV07XG4gIGRlZmF1bHQ6XG4gICAgaWYgKHN0YXRlLm5vdGV4dGlsZSlcbiAgICAgIHJldHVybiBUT0tFTl9TVFlMRVMubm90ZXh0aWxlICsgKHR5cGUgPyAoXCIgXCIgKyBUT0tFTl9TVFlMRVNbdHlwZV0pIDogXCJcIik7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbn1cblxuZnVuY3Rpb24gYWN0aXZlU3R5bGVzKHN0YXRlKSB7XG4gIHZhciBzdHlsZXMgPSBbXTtcbiAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyArK2kpIHtcbiAgICBpZiAoc3RhdGVbYXJndW1lbnRzW2ldXSlcbiAgICAgIHN0eWxlcy5wdXNoKFRPS0VOX1NUWUxFU1thcmd1bWVudHNbaV1dKTtcbiAgfVxuICByZXR1cm4gc3R5bGVzO1xufVxuXG5mdW5jdGlvbiBibGFua0xpbmUoc3RhdGUpIHtcbiAgdmFyIHNwYW5uaW5nTGF5b3V0ID0gc3RhdGUuc3Bhbm5pbmdMYXlvdXQsIHR5cGUgPSBzdGF0ZS5sYXlvdXRUeXBlO1xuXG4gIGZvciAodmFyIGtleSBpbiBzdGF0ZSkgaWYgKHN0YXRlLmhhc093blByb3BlcnR5KGtleSkpXG4gICAgZGVsZXRlIHN0YXRlW2tleV07XG5cbiAgc3RhdGUubW9kZSA9IE1vZGVzLm5ld0xheW91dDtcbiAgaWYgKHNwYW5uaW5nTGF5b3V0KSB7XG4gICAgc3RhdGUubGF5b3V0VHlwZSA9IHR5cGU7XG4gICAgc3RhdGUuc3Bhbm5pbmdMYXlvdXQgPSB0cnVlO1xuICB9XG59XG5cbnZhciBSRXMgPSB7XG4gIGNhY2hlOiB7fSxcbiAgc2luZ2xlOiB7XG4gICAgYmM6IFwiYmNcIixcbiAgICBicTogXCJicVwiLFxuICAgIGRlZmluaXRpb25MaXN0OiAvLSAuKj86PSsvLFxuICAgIGRlZmluaXRpb25MaXN0RW5kOiAvLio9OlxccyokLyxcbiAgICBkaXY6IFwiZGl2XCIsXG4gICAgZHJhd1RhYmxlOiAvXFx8LipcXHwvLFxuICAgIGZvb3Q6IC9mblxcZCsvLFxuICAgIGhlYWRlcjogL2hbMS02XS8sXG4gICAgaHRtbDogL1xccyo8KD86XFwvKT8oXFx3KykoPzpbXj5dKyk/Pig/OltePF0rPFxcL1xcMT4pPy8sXG4gICAgbGluazogL1teXCJdK1wiOlxcUy8sXG4gICAgbGlua0RlZmluaXRpb246IC9cXFtbXlxcc1xcXV0rXFxdXFxTKy8sXG4gICAgbGlzdDogLyg/OiMrfFxcKispLyxcbiAgICBub3RleHRpbGU6IFwibm90ZXh0aWxlXCIsXG4gICAgcGFyYTogXCJwXCIsXG4gICAgcHJlOiBcInByZVwiLFxuICAgIHRhYmxlOiBcInRhYmxlXCIsXG4gICAgdGFibGVDZWxsQXR0cmlidXRlczogL1tcXC9cXFxcXVxcZCsvLFxuICAgIHRhYmxlSGVhZGluZzogL1xcfF9cXC4vLFxuICAgIHRhYmxlVGV4dDogL1teXCJfXFwqXFxbXFwoXFw/XFwrflxcXiVAfC1dKy8sXG4gICAgdGV4dDogL1teIVwiXz1cXCpcXFtcXCg8XFw/XFwrflxcXiVALV0rL1xuICB9LFxuICBhdHRyaWJ1dGVzOiB7XG4gICAgYWxpZ246IC8oPzo8Pnw8fD58PSkvLFxuICAgIHNlbGVjdG9yOiAvXFwoW15cXChdW15cXCldK1xcKS8sXG4gICAgbGFuZzogL1xcW1teXFxbXFxdXStcXF0vLFxuICAgIHBhZDogLyg/OlxcKCt8XFwpKyl7MSwyfS8sXG4gICAgY3NzOiAvXFx7W15cXH1dK1xcfS9cbiAgfSxcbiAgY3JlYXRlUmU6IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICBzd2l0Y2ggKG5hbWUpIHtcbiAgICBjYXNlIFwiZHJhd1RhYmxlXCI6XG4gICAgICByZXR1cm4gUkVzLm1ha2VSZShcIl5cIiwgUkVzLnNpbmdsZS5kcmF3VGFibGUsIFwiJFwiKTtcbiAgICBjYXNlIFwiaHRtbFwiOlxuICAgICAgcmV0dXJuIFJFcy5tYWtlUmUoXCJeXCIsIFJFcy5zaW5nbGUuaHRtbCwgXCIoPzpcIiwgUkVzLnNpbmdsZS5odG1sLCBcIikqXCIsIFwiJFwiKTtcbiAgICBjYXNlIFwibGlua0RlZmluaXRpb25cIjpcbiAgICAgIHJldHVybiBSRXMubWFrZVJlKFwiXlwiLCBSRXMuc2luZ2xlLmxpbmtEZWZpbml0aW9uLCBcIiRcIik7XG4gICAgY2FzZSBcImxpc3RMYXlvdXRcIjpcbiAgICAgIHJldHVybiBSRXMubWFrZVJlKFwiXlwiLCBSRXMuc2luZ2xlLmxpc3QsIFJFKFwiYWxsQXR0cmlidXRlc1wiKSwgXCIqXFxcXHMrXCIpO1xuICAgIGNhc2UgXCJ0YWJsZUNlbGxBdHRyaWJ1dGVzXCI6XG4gICAgICByZXR1cm4gUkVzLm1ha2VSZShcIl5cIiwgUkVzLmNob2ljZVJlKFJFcy5zaW5nbGUudGFibGVDZWxsQXR0cmlidXRlcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFJFKFwiYWxsQXR0cmlidXRlc1wiKSksIFwiK1xcXFwuXCIpO1xuICAgIGNhc2UgXCJ0eXBlXCI6XG4gICAgICByZXR1cm4gUkVzLm1ha2VSZShcIl5cIiwgUkUoXCJhbGxUeXBlc1wiKSk7XG4gICAgY2FzZSBcInR5cGVMYXlvdXRcIjpcbiAgICAgIHJldHVybiBSRXMubWFrZVJlKFwiXlwiLCBSRShcImFsbFR5cGVzXCIpLCBSRShcImFsbEF0dHJpYnV0ZXNcIiksXG4gICAgICAgICAgICAgICAgICAgICAgICBcIipcXFxcLlxcXFwuP1wiLCBcIihcXFxccyt8JClcIik7XG4gICAgY2FzZSBcImF0dHJpYnV0ZXNcIjpcbiAgICAgIHJldHVybiBSRXMubWFrZVJlKFwiXlwiLCBSRShcImFsbEF0dHJpYnV0ZXNcIiksIFwiK1wiKTtcblxuICAgIGNhc2UgXCJhbGxUeXBlc1wiOlxuICAgICAgcmV0dXJuIFJFcy5jaG9pY2VSZShSRXMuc2luZ2xlLmRpdiwgUkVzLnNpbmdsZS5mb290LFxuICAgICAgICAgICAgICAgICAgICAgICAgICBSRXMuc2luZ2xlLmhlYWRlciwgUkVzLnNpbmdsZS5iYywgUkVzLnNpbmdsZS5icSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgUkVzLnNpbmdsZS5ub3RleHRpbGUsIFJFcy5zaW5nbGUucHJlLCBSRXMuc2luZ2xlLnRhYmxlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICBSRXMuc2luZ2xlLnBhcmEpO1xuXG4gICAgY2FzZSBcImFsbEF0dHJpYnV0ZXNcIjpcbiAgICAgIHJldHVybiBSRXMuY2hvaWNlUmUoUkVzLmF0dHJpYnV0ZXMuc2VsZWN0b3IsIFJFcy5hdHRyaWJ1dGVzLmNzcyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgUkVzLmF0dHJpYnV0ZXMubGFuZywgUkVzLmF0dHJpYnV0ZXMuYWxpZ24sIFJFcy5hdHRyaWJ1dGVzLnBhZCk7XG5cbiAgICBkZWZhdWx0OlxuICAgICAgcmV0dXJuIFJFcy5tYWtlUmUoXCJeXCIsIFJFcy5zaW5nbGVbbmFtZV0pO1xuICAgIH1cbiAgfSxcbiAgbWFrZVJlOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgcGF0dGVybiA9IFwiXCI7XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyArK2kpIHtcbiAgICAgIHZhciBhcmcgPSBhcmd1bWVudHNbaV07XG4gICAgICBwYXR0ZXJuICs9ICh0eXBlb2YgYXJnID09PSBcInN0cmluZ1wiKSA/IGFyZyA6IGFyZy5zb3VyY2U7XG4gICAgfVxuICAgIHJldHVybiBuZXcgUmVnRXhwKHBhdHRlcm4pO1xuICB9LFxuICBjaG9pY2VSZTogZnVuY3Rpb24oKSB7XG4gICAgdmFyIHBhcnRzID0gW2FyZ3VtZW50c1swXV07XG4gICAgZm9yICh2YXIgaSA9IDE7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyArK2kpIHtcbiAgICAgIHBhcnRzW2kgKiAyIC0gMV0gPSBcInxcIjtcbiAgICAgIHBhcnRzW2kgKiAyXSA9IGFyZ3VtZW50c1tpXTtcbiAgICB9XG5cbiAgICBwYXJ0cy51bnNoaWZ0KFwiKD86XCIpO1xuICAgIHBhcnRzLnB1c2goXCIpXCIpO1xuICAgIHJldHVybiBSRXMubWFrZVJlLmFwcGx5KG51bGwsIHBhcnRzKTtcbiAgfVxufTtcblxuZnVuY3Rpb24gUkUobmFtZSkge1xuICByZXR1cm4gKFJFcy5jYWNoZVtuYW1lXSB8fCAoUkVzLmNhY2hlW25hbWVdID0gUkVzLmNyZWF0ZVJlKG5hbWUpKSk7XG59XG5cbnZhciBNb2RlcyA9IHtcbiAgbmV3TGF5b3V0OiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgaWYgKHN0cmVhbS5tYXRjaChSRShcInR5cGVMYXlvdXRcIiksIGZhbHNlKSkge1xuICAgICAgc3RhdGUuc3Bhbm5pbmdMYXlvdXQgPSBmYWxzZTtcbiAgICAgIHJldHVybiAoc3RhdGUubW9kZSA9IE1vZGVzLmJsb2NrVHlwZSkoc3RyZWFtLCBzdGF0ZSk7XG4gICAgfVxuICAgIHZhciBuZXdNb2RlO1xuICAgIGlmICghdGV4dGlsZURpc2FibGVkKHN0YXRlKSkge1xuICAgICAgaWYgKHN0cmVhbS5tYXRjaChSRShcImxpc3RMYXlvdXRcIiksIGZhbHNlKSlcbiAgICAgICAgbmV3TW9kZSA9IE1vZGVzLmxpc3Q7XG4gICAgICBlbHNlIGlmIChzdHJlYW0ubWF0Y2goUkUoXCJkcmF3VGFibGVcIiksIGZhbHNlKSlcbiAgICAgICAgbmV3TW9kZSA9IE1vZGVzLnRhYmxlO1xuICAgICAgZWxzZSBpZiAoc3RyZWFtLm1hdGNoKFJFKFwibGlua0RlZmluaXRpb25cIiksIGZhbHNlKSlcbiAgICAgICAgbmV3TW9kZSA9IE1vZGVzLmxpbmtEZWZpbml0aW9uO1xuICAgICAgZWxzZSBpZiAoc3RyZWFtLm1hdGNoKFJFKFwiZGVmaW5pdGlvbkxpc3RcIikpKVxuICAgICAgICBuZXdNb2RlID0gTW9kZXMuZGVmaW5pdGlvbkxpc3Q7XG4gICAgICBlbHNlIGlmIChzdHJlYW0ubWF0Y2goUkUoXCJodG1sXCIpLCBmYWxzZSkpXG4gICAgICAgIG5ld01vZGUgPSBNb2Rlcy5odG1sO1xuICAgIH1cbiAgICByZXR1cm4gKHN0YXRlLm1vZGUgPSAobmV3TW9kZSB8fCBNb2Rlcy50ZXh0KSkoc3RyZWFtLCBzdGF0ZSk7XG4gIH0sXG5cbiAgYmxvY2tUeXBlOiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgdmFyIG1hdGNoLCB0eXBlO1xuICAgIHN0YXRlLmxheW91dFR5cGUgPSBudWxsO1xuXG4gICAgaWYgKG1hdGNoID0gc3RyZWFtLm1hdGNoKFJFKFwidHlwZVwiKSkpXG4gICAgICB0eXBlID0gbWF0Y2hbMF07XG4gICAgZWxzZVxuICAgICAgcmV0dXJuIChzdGF0ZS5tb2RlID0gTW9kZXMudGV4dCkoc3RyZWFtLCBzdGF0ZSk7XG5cbiAgICBpZiAobWF0Y2ggPSB0eXBlLm1hdGNoKFJFKFwiaGVhZGVyXCIpKSkge1xuICAgICAgc3RhdGUubGF5b3V0VHlwZSA9IFwiaGVhZGVyXCI7XG4gICAgICBzdGF0ZS5oZWFkZXIgPSBwYXJzZUludChtYXRjaFswXVsxXSk7XG4gICAgfSBlbHNlIGlmICh0eXBlLm1hdGNoKFJFKFwiYnFcIikpKSB7XG4gICAgICBzdGF0ZS5sYXlvdXRUeXBlID0gXCJxdW90ZVwiO1xuICAgIH0gZWxzZSBpZiAodHlwZS5tYXRjaChSRShcImJjXCIpKSkge1xuICAgICAgc3RhdGUubGF5b3V0VHlwZSA9IFwiY29kZVwiO1xuICAgIH0gZWxzZSBpZiAodHlwZS5tYXRjaChSRShcImZvb3RcIikpKSB7XG4gICAgICBzdGF0ZS5sYXlvdXRUeXBlID0gXCJmb290bm90ZVwiO1xuICAgIH0gZWxzZSBpZiAodHlwZS5tYXRjaChSRShcIm5vdGV4dGlsZVwiKSkpIHtcbiAgICAgIHN0YXRlLmxheW91dFR5cGUgPSBcIm5vdGV4dGlsZVwiO1xuICAgIH0gZWxzZSBpZiAodHlwZS5tYXRjaChSRShcInByZVwiKSkpIHtcbiAgICAgIHN0YXRlLmxheW91dFR5cGUgPSBcInByZVwiO1xuICAgIH0gZWxzZSBpZiAodHlwZS5tYXRjaChSRShcImRpdlwiKSkpIHtcbiAgICAgIHN0YXRlLmxheW91dFR5cGUgPSBcImRpdlwiO1xuICAgIH0gZWxzZSBpZiAodHlwZS5tYXRjaChSRShcInRhYmxlXCIpKSkge1xuICAgICAgc3RhdGUubGF5b3V0VHlwZSA9IFwidGFibGVcIjtcbiAgICB9XG5cbiAgICBzdGF0ZS5tb2RlID0gTW9kZXMuYXR0cmlidXRlcztcbiAgICByZXR1cm4gdG9rZW5TdHlsZXMoc3RhdGUpO1xuICB9LFxuXG4gIHRleHQ6IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICBpZiAoc3RyZWFtLm1hdGNoKFJFKFwidGV4dFwiKSkpIHJldHVybiB0b2tlblN0eWxlcyhzdGF0ZSk7XG5cbiAgICB2YXIgY2ggPSBzdHJlYW0ubmV4dCgpO1xuICAgIGlmIChjaCA9PT0gJ1wiJylcbiAgICAgIHJldHVybiAoc3RhdGUubW9kZSA9IE1vZGVzLmxpbmspKHN0cmVhbSwgc3RhdGUpO1xuICAgIHJldHVybiBoYW5kbGVQaHJhc2VNb2RpZmllcihzdHJlYW0sIHN0YXRlLCBjaCk7XG4gIH0sXG5cbiAgYXR0cmlidXRlczogZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkge1xuICAgIHN0YXRlLm1vZGUgPSBNb2Rlcy5sYXlvdXRMZW5ndGg7XG5cbiAgICBpZiAoc3RyZWFtLm1hdGNoKFJFKFwiYXR0cmlidXRlc1wiKSkpXG4gICAgICByZXR1cm4gVE9LRU5fU1RZTEVTLmF0dHJpYnV0ZXNcbiAgICBlbHNlXG4gICAgICByZXR1cm4gdG9rZW5TdHlsZXMoc3RhdGUpO1xuICB9LFxuXG4gIGxheW91dExlbmd0aDogZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkge1xuICAgIGlmIChzdHJlYW0uZWF0KFwiLlwiKSAmJiBzdHJlYW0uZWF0KFwiLlwiKSlcbiAgICAgIHN0YXRlLnNwYW5uaW5nTGF5b3V0ID0gdHJ1ZTtcblxuICAgIHN0YXRlLm1vZGUgPSBNb2Rlcy50ZXh0O1xuICAgIHJldHVybiB0b2tlblN0eWxlcyhzdGF0ZSk7XG4gIH0sXG5cbiAgbGlzdDogZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkge1xuICAgIHZhciBtYXRjaCA9IHN0cmVhbS5tYXRjaChSRShcImxpc3RcIikpO1xuICAgIHN0YXRlLmxpc3REZXB0aCA9IG1hdGNoWzBdLmxlbmd0aDtcbiAgICB2YXIgbGlzdE1vZCA9IChzdGF0ZS5saXN0RGVwdGggLSAxKSAlIDM7XG4gICAgaWYgKCFsaXN0TW9kKVxuICAgICAgc3RhdGUubGF5b3V0VHlwZSA9IFwibGlzdDFcIjtcbiAgICBlbHNlIGlmIChsaXN0TW9kID09PSAxKVxuICAgICAgc3RhdGUubGF5b3V0VHlwZSA9IFwibGlzdDJcIjtcbiAgICBlbHNlXG4gICAgICBzdGF0ZS5sYXlvdXRUeXBlID0gXCJsaXN0M1wiO1xuXG4gICAgc3RhdGUubW9kZSA9IE1vZGVzLmF0dHJpYnV0ZXM7XG4gICAgcmV0dXJuIHRva2VuU3R5bGVzKHN0YXRlKTtcbiAgfSxcblxuICBsaW5rOiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgc3RhdGUubW9kZSA9IE1vZGVzLnRleHQ7XG4gICAgaWYgKHN0cmVhbS5tYXRjaChSRShcImxpbmtcIikpKSB7XG4gICAgICBzdHJlYW0ubWF0Y2goL1xcUysvKTtcbiAgICAgIHJldHVybiBUT0tFTl9TVFlMRVMubGlua1xuICAgIH1cbiAgICByZXR1cm4gdG9rZW5TdHlsZXMoc3RhdGUpO1xuICB9LFxuXG4gIGxpbmtEZWZpbml0aW9uOiBmdW5jdGlvbihzdHJlYW0pIHtcbiAgICBzdHJlYW0uc2tpcFRvRW5kKCk7XG4gICAgcmV0dXJuIFRPS0VOX1NUWUxFUy5saW5rRGVmaW5pdGlvblxuICB9LFxuXG4gIGRlZmluaXRpb25MaXN0OiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgc3RyZWFtLm1hdGNoKFJFKFwiZGVmaW5pdGlvbkxpc3RcIikpO1xuXG4gICAgc3RhdGUubGF5b3V0VHlwZSA9IFwiZGVmaW5pdGlvbkxpc3RcIjtcblxuICAgIGlmIChzdHJlYW0ubWF0Y2goL1xccyokLykpXG4gICAgICBzdGF0ZS5zcGFubmluZ0xheW91dCA9IHRydWU7XG4gICAgZWxzZVxuICAgICAgc3RhdGUubW9kZSA9IE1vZGVzLmF0dHJpYnV0ZXM7XG5cbiAgICByZXR1cm4gdG9rZW5TdHlsZXMoc3RhdGUpO1xuICB9LFxuXG4gIGh0bWw6IGZ1bmN0aW9uKHN0cmVhbSkge1xuICAgIHN0cmVhbS5za2lwVG9FbmQoKTtcbiAgICByZXR1cm4gVE9LRU5fU1RZTEVTLmh0bWxcbiAgfSxcblxuICB0YWJsZTogZnVuY3Rpb24oc3RyZWFtLCBzdGF0ZSkge1xuICAgIHN0YXRlLmxheW91dFR5cGUgPSBcInRhYmxlXCI7XG4gICAgcmV0dXJuIChzdGF0ZS5tb2RlID0gTW9kZXMudGFibGVDZWxsKShzdHJlYW0sIHN0YXRlKTtcbiAgfSxcblxuICB0YWJsZUNlbGw6IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICBpZiAoc3RyZWFtLm1hdGNoKFJFKFwidGFibGVIZWFkaW5nXCIpKSlcbiAgICAgIHN0YXRlLnRhYmxlSGVhZGluZyA9IHRydWU7XG4gICAgZWxzZVxuICAgICAgc3RyZWFtLmVhdChcInxcIik7XG5cbiAgICBzdGF0ZS5tb2RlID0gTW9kZXMudGFibGVDZWxsQXR0cmlidXRlcztcbiAgICByZXR1cm4gdG9rZW5TdHlsZXMoc3RhdGUpO1xuICB9LFxuXG4gIHRhYmxlQ2VsbEF0dHJpYnV0ZXM6IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICBzdGF0ZS5tb2RlID0gTW9kZXMudGFibGVUZXh0O1xuXG4gICAgaWYgKHN0cmVhbS5tYXRjaChSRShcInRhYmxlQ2VsbEF0dHJpYnV0ZXNcIikpKVxuICAgICAgcmV0dXJuIFRPS0VOX1NUWUxFUy5hdHRyaWJ1dGVzXG4gICAgZWxzZVxuICAgICAgcmV0dXJuIHRva2VuU3R5bGVzKHN0YXRlKTtcbiAgfSxcblxuICB0YWJsZVRleHQ6IGZ1bmN0aW9uKHN0cmVhbSwgc3RhdGUpIHtcbiAgICBpZiAoc3RyZWFtLm1hdGNoKFJFKFwidGFibGVUZXh0XCIpKSlcbiAgICAgIHJldHVybiB0b2tlblN0eWxlcyhzdGF0ZSk7XG5cbiAgICBpZiAoc3RyZWFtLnBlZWsoKSA9PT0gXCJ8XCIpIHsgLy8gZW5kIG9mIGNlbGxcbiAgICAgIHN0YXRlLm1vZGUgPSBNb2Rlcy50YWJsZUNlbGw7XG4gICAgICByZXR1cm4gdG9rZW5TdHlsZXMoc3RhdGUpO1xuICAgIH1cbiAgICByZXR1cm4gaGFuZGxlUGhyYXNlTW9kaWZpZXIoc3RyZWFtLCBzdGF0ZSwgc3RyZWFtLm5leHQoKSk7XG4gIH1cbn07XG5cbmV4cG9ydCBjb25zdCB0ZXh0aWxlID0ge1xuICBuYW1lOiBcInRleHRpbGVcIixcbiAgc3RhcnRTdGF0ZTogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHsgbW9kZTogTW9kZXMubmV3TGF5b3V0IH07XG4gIH0sXG4gIHRva2VuOiBmdW5jdGlvbihzdHJlYW0sIHN0YXRlKSB7XG4gICAgaWYgKHN0cmVhbS5zb2woKSkgc3RhcnROZXdMaW5lKHN0cmVhbSwgc3RhdGUpO1xuICAgIHJldHVybiBzdGF0ZS5tb2RlKHN0cmVhbSwgc3RhdGUpO1xuICB9LFxuICBibGFua0xpbmU6IGJsYW5rTGluZVxufTtcbiJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==