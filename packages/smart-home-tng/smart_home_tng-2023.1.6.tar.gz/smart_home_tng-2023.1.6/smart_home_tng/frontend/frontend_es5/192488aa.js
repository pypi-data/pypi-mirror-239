"use strict";(self.webpackChunkhome_assistant_frontend=self.webpackChunkhome_assistant_frontend||[]).push([[55424],{92306:function(t,n,e){function r(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(!t)return;if("string"==typeof t)return o(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return o(t,n)}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,u=function(){};return{s:u,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:u}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==e.return||e.return()}finally{if(c)throw i}}}}function o(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}e.d(n,{v:function(){return u}});var u=function(t,n){var e,o={},u=r(t);try{for(u.s();!(e=u.n()).done;){var i=e.value,a=n(i);a in o?o[a].push(i):o[a]=[i]}}catch(c){u.e(c)}finally{u.f()}return o}},11950:function(t,n,e){function r(t,n,e,r,o,u,i){try{var a=t[u](i),c=a.value}catch(s){return void e(s)}a.done?n(c):Promise.resolve(c).then(r,o)}e.d(n,{l:function(){return o}});var o=function(){var t,n=(t=regeneratorRuntime.mark((function t(n,e){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var r=e(n,(function(n){r(),t(n)}))})));case 1:case"end":return t.stop()}}),t)})),function(){var n=this,e=arguments;return new Promise((function(o,u){var i=t.apply(n,e);function a(t){r(i,o,u,a,c,"next",t)}function c(t){r(i,o,u,a,c,"throw",t)}a(void 0)}))});return function(t,e){return n.apply(this,arguments)}}()},81582:function(t,n,e){e.d(n,{LZ:function(){return r},Q4:function(){return o},pB:function(){return u},SO:function(){return i},iJ:function(){return a},Nn:function(){return c},Ny:function(){return s},T0:function(){return f}});var r=["migration_error","setup_error","setup_retry"],o=["not_loaded","loaded","setup_error","setup_retry"],u=function(t,n){var e={};return n&&(n.type&&(e.type_filter=n.type),n.domain&&(e.domain=n.domain)),t.callWS(Object.assign({type:"config_entries/get"},e))},i=function(t,n,e){return t.callWS(Object.assign({type:"config_entries/update",entry_id:n},e))},a=function(t,n){return t.callApi("DELETE","config/config_entries/entry/".concat(n))},c=function(t,n){return t.callApi("POST","config/config_entries/entry/".concat(n,"/reload"))},s=function(t,n){return t.callWS({type:"config_entries/disable",entry_id:n,disabled_by:"user"})},f=function(t,n){return t.callWS({type:"config_entries/disable",entry_id:n,disabled_by:null})}},55424:function(t,n,e){e.d(n,{Bm:function(){return C},o1:function(){return I},iK:function(){return M},rl:function(){return D},P:function(){return B},KU:function(){return L},xZ:function(){return H},gy:function(){return K},ZC:function(){return N},_Z:function(){return $},Jj:function(){return J},yH:function(){return q},UB:function(){return G},jB:function(){return V},gM:function(){return X},yT:function(){return Y},_n:function(){return tt},vR:function(){return nt},vE:function(){return et}});var r=e(4535),o=e(59699),u=e(32182),i=e(79021),a=e(39244),c=e(27088),s=e(83008),f=e(70390),l=e(47538),y=e(97330),p=e(92306),d=e(11950),_=e(81582),m=e(74186),v=e(38014);function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function h(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){var e=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==e)return;var r,o,u=[],i=!0,a=!1;try{for(e=e.call(t);!(i=(r=e.next()).done)&&(u.push(r.value),!n||u.length!==n);i=!0);}catch(c){a=!0,o=c}finally{try{i||null==e.return||e.return()}finally{if(a)throw o}}return u}(t,n)||w(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=w(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var u,i=!0,a=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return i=t.done,t},e:function(t){a=!0,u=t},f:function(){try{i||null==e.return||e.return()}finally{if(a)throw u}}}}function w(t,n){if(t){if("string"==typeof t)return S(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?S(t,n):void 0}}function S(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}function x(t,n,e,r,o,u,i){try{var a=t[u](i),c=a.value}catch(s){return void e(s)}a.done?n(c):Promise.resolve(c).then(r,o)}function j(t){return function(){var n=this,e=arguments;return new Promise((function(r,o){var u=t.apply(n,e);function i(t){x(u,r,o,i,a,"next",t)}function a(t){x(u,r,o,i,a,"throw",t)}i(void 0)}))}}function O(t,n){if(n&&("object"===g(n)||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return T(t)}function T(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function k(t){var n="function"==typeof Map?new Map:void 0;return k=function(t){if(null===t||(e=t,-1===Function.toString.call(e).indexOf("[native code]")))return t;var e;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==n){if(n.has(t))return n.get(t);n.set(t,r)}function r(){return P(t,arguments,R(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),E(r,t)},k(t)}function P(t,n,e){return P=A()?Reflect.construct:function(t,n,e){var r=[null];r.push.apply(r,n);var o=new(Function.bind.apply(t,r));return e&&E(o,e.prototype),o},P.apply(null,arguments)}function A(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function E(t,n){return E=Object.setPrototypeOf||function(t,n){return t.__proto__=n,t},E(t,n)}function R(t){return R=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},R(t)}var W,Z=[],C=function(){return{stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},I=function(){return{stat_energy_to:"",stat_compensation:null,entity_energy_price:null,number_energy_price:null}},M=function(){return{type:"grid",flow_from:[],flow_to:[],cost_adjustment_day:0}},D=function(){return{type:"solar",stat_energy_from:"",config_entry_solar_forecast:null}},B=function(){return{type:"battery",stat_energy_from:"",stat_energy_to:""}},L=function(){return{type:"gas",stat_energy_from:"",stat_cost:null,entity_energy_price:null,number_energy_price:null}},H=function(t){return t.callWS({type:"energy/info"})},K=function(t){return t.callWS({type:"energy/validate"})},U=function(t){!function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(n&&n.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),n&&E(t,n)}(o,t);var n,e,r=(n=o,e=A(),function(){var t,r=R(n);if(e){var o=R(this).constructor;t=Reflect.construct(r,arguments,o)}else t=r.apply(this,arguments);return O(this,t)});function o(t){var n,e,u,i;return function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,o),n=r.call(this,t),e=T(n),i="not_found",(u="code")in e?Object.defineProperty(e,u,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[u]=i,Object.setPrototypeOf(T(n),(this instanceof o?this.constructor:void 0).prototype),n}return o}(k(Error)),N=function(){var t=j(regeneratorRuntime.mark((function t(n){var e,r,o,u,i=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=i.length>1&&void 0!==i[1]&&i[1],t.next=3,n.callWS({type:"energy/get_prefs"});case 3:if(r=t.sent,!e){t.next=9;break}if(o=r.energy_sources.length>0,u=r.device_consumption.length>0,o||u){t.next=9;break}throw new U;case 9:return t.abrupt("return",r);case 10:case"end":return t.stop()}}),t)})));return function(n){return t.apply(this,arguments)}}(),$=32143==e.j?(W=j(regeneratorRuntime.mark((function t(n,e){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.callWS(Object.assign({type:"energy/save_prefs"},e)),z(n),t.abrupt("return",r);case 3:case"end":return t.stop()}}),t)}))),function(t,n){return W.apply(this,arguments)}):null,F=function(){var t=j(regeneratorRuntime.mark((function t(n,e,r,o,u){var i,a=arguments;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.length>5&&void 0!==a[5]?a[5]:"hour",t.abrupt("return",n.callWS({type:"energy/fossil_energy_consumption",start_time:e.toISOString(),end_time:null==u?void 0:u.toISOString(),energy_statistic_ids:r,co2_statistic_id:o,period:i}));case 2:case"end":return t.stop()}}),t)})));return function(n,e,r,o,u){return t.apply(this,arguments)}}(),J=function(t){return(0,p.v)(t.energy_sources,(function(t){return t.type}))},q=function(t,n){var e,r=[],o=b(t.energy_sources);try{for(o.s();!(e=o.n()).done;){var u=e.value;if("solar"!==u.type)if("gas"!==u.type)if("battery"!==u.type){var i,a=b(u.flow_from);try{for(a.s();!(i=a.n()).done;){var c=i.value;r.push(c.stat_energy_from),c.stat_cost&&r.push(c.stat_cost);var s=n.cost_sensors[c.stat_energy_from];s&&r.push(s)}}catch(g){a.e(g)}finally{a.f()}var f,l=b(u.flow_to);try{for(l.s();!(f=l.n()).done;){var y=f.value;r.push(y.stat_energy_to),y.stat_compensation&&r.push(y.stat_compensation);var p=n.cost_sensors[y.stat_energy_to];p&&r.push(p)}}catch(g){l.e(g)}finally{l.f()}}else r.push(u.stat_energy_from),r.push(u.stat_energy_to);else{r.push(u.stat_energy_from),u.stat_cost&&r.push(u.stat_cost);var d=n.cost_sensors[u.stat_energy_from];d&&r.push(d)}else r.push(u.stat_energy_from)}}catch(g){o.e(g)}finally{o.f()}var _,m=b(t.device_consumption);try{for(m.s();!(_=m.n()).done;){var v=_.value;r.push(v.stat_consumption)}}catch(g){m.e(g)}finally{m.f()}return r},Q=function(){var t=j(regeneratorRuntime.mark((function t(n,e,c,s,f){var l,y,p,g,w,S,x,j,O,T,k,P,A,E,R,W,Z,C,I,M,D,B,L,K,U,N,$,J,Q,z,G,V,X,Y;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Promise.all([(0,_.pB)(n,{domain:"co2signal"}),(0,d.l)(n.connection,m.LM),H(n)]);case 2:if(l=t.sent,y=h(l,3),p=y[0],g=y[1],w=y[2],!(S=p.length?p[0]:void 0)){t.next=31;break}j=b(g),t.prev=10,j.s();case 12:if((O=j.n()).done){t.next=23;break}if((T=O.value).config_entry_id===S.entry_id){t.next=16;break}return t.abrupt("continue",21);case 16:if((k=n.states[T.entity_id])&&"%"===k.attributes.unit_of_measurement){t.next=19;break}return t.abrupt("continue",21);case 19:return x=k.entity_id,t.abrupt("break",23);case 21:t.next=12;break;case 23:t.next=28;break;case 25:t.prev=25,t.t0=t.catch(10),j.e(t.t0);case 28:return t.prev=28,j.f(),t.finish(28);case 31:P=[],A=b(e.energy_sources);try{for(A.s();!(E=A.n()).done;)if("grid"===(R=E.value).type){W=b(R.flow_from);try{for(W.s();!(Z=W.n()).done;)C=Z.value,P.push(C.stat_energy_from)}catch(tt){W.e(tt)}finally{W.f()}}}catch(tt){A.e(tt)}finally{A.f()}return I=q(e,w),M=(0,r.Z)(s||new Date,c),D=M>35?"month":M>2?"day":"hour",B=(0,o.Z)(c,-1),L=n.config.unit_system.length||"",K={energy:"kWh",volume:"km"===L?"m³":"ft³"},t.next=42,(0,v.dL)(n,B,s,I,D,K);case 42:if(U=t.sent,!f){t.next=50;break}return $=M>27&&M<32?(0,u.Z)(c,-1):(0,i.Z)(c,-1*(M+1)),Q=(0,o.Z)($,-1),J=(0,a.Z)(c,-1),t.next=49,(0,v.dL)(n,Q,J,I,D,K);case 49:N=t.sent;case 50:if(void 0===x){t.next=58;break}return t.next=53,F(n,c,P,x,s,M>35?"month":M>2?"day":"hour");case 53:if(z=t.sent,!f){t.next=58;break}return t.next=57,F(n,$,P,x,J,M>35?"month":M>2?"day":"hour");case 57:G=t.sent;case 58:return Object.values(U).forEach((function(t){t.length&&new Date(t[0].start)>B&&t.unshift(Object.assign({},t[0],{start:B.toISOString(),end:B.toISOString(),sum:0,state:0}))})),t.next=61,(0,v.Py)(n,I);case 61:return V=t.sent,X={},V.forEach((function(t){X[t.statistic_id]=t})),Y={start:c,end:s,startCompare:$,endCompare:J,info:w,prefs:e,stats:U,statsMetadata:X,statsCompare:N,co2SignalConfigEntry:S,co2SignalEntity:x,fossilEnergyConsumption:z,fossilEnergyConsumptionCompare:G},t.abrupt("return",Y);case 66:case"end":return t.stop()}}),t,null,[[10,25,28,31]])})));return function(n,e,r,o,u){return t.apply(this,arguments)}}(),z=function(t){Z.forEach((function(n){var e=G(t,{key:n});e.clearPrefs(),e._active&&e.refresh()}))},G=function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e="_energy";if(n.key){if(!n.key.startsWith("energy_"))throw new Error("Key need to start with energy_");e="_".concat(n.key)}if(t.connection[e])return t.connection[e];Z.push(n.key);var r=(0,y._)(t.connection,e,j(regeneratorRuntime.mark((function n(){var e;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.prefs){n.next=4;break}return n.next=3,N(t,!0);case 3:r.prefs=n.sent;case 4:return r._refreshTimeout&&clearTimeout(r._refreshTimeout),r._active&&(!r.end||r.end>new Date)&&((e=new Date).getMinutes()>=20&&e.setHours(e.getHours()+1),e.setMinutes(20,0,0),r._refreshTimeout=window.setTimeout((function(){return r.refresh()}),e.getTime()-Date.now())),n.abrupt("return",Q(t,r.prefs,r.start,r.end,r.compare));case 7:case"end":return n.stop()}}),n)})))),u=r.subscribe;r.subscribe=function(t){var n=u(t);return r._active++,function(){r._active--,r._active<1&&(clearTimeout(r._refreshTimeout),r._refreshTimeout=void 0),n()}},r._active=0,r.prefs=n.prefs;var i=new Date;r.start=i.getHours()>0?(0,c.Z)():(0,s.Z)(),r.end=i.getHours()>0?(0,f.Z)():(0,l.Z)();var a=function t(){r._updatePeriodTimeout=window.setTimeout((function(){r.start=(0,c.Z)(),r.end=(0,f.Z)(),t()}),(0,o.Z)((0,f.Z)(),1).getTime()-Date.now())};return a(),r.clearPrefs=function(){r.prefs=void 0},r.setPeriod=function(t,n){var e;r.start=t,r.end=n,r.start.getTime()!==(0,c.Z)().getTime()||(null===(e=r.end)||void 0===e?void 0:e.getTime())!==(0,f.Z)().getTime()||r._updatePeriodTimeout?r._updatePeriodTimeout&&(clearTimeout(r._updatePeriodTimeout),r._updatePeriodTimeout=void 0):a()},r.setCompare=function(t){r.compare=t},r},V=function(t){return t.callWS({type:"energy/solar_forecast"})},X=["m³"],Y=["kWh"],tt=[].concat(X,Y),nt=function(t){var n,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o=b(t.energy_sources);try{for(o.s();!(n=o.n()).done;){var u=n.value;if("gas"===u.type&&(!r||r!==u.stat_energy_from)){var i=e[u.stat_energy_from];if(i)return X.includes(i.statistics_unit_of_measurement)?"volume":"energy"}}}catch(a){o.e(a)}finally{o.f()}},et=function(t){var n,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=b(t.energy_sources);try{for(r.s();!(n=r.n()).done;){var o=n.value;if("gas"===o.type){var u=e[o.stat_energy_from];if(null!=u&&u.display_unit_of_measurement)return u.display_unit_of_measurement}}}catch(i){r.e(i)}finally{r.f()}}},38014:function(t,n,e){e.d(n,{uR:function(){return i},Py:function(){return a},dL:function(){return c},h_:function(){return s},Cj:function(){return f},ZT:function(){return l},hN:function(){return y},Kj:function(){return p},q6:function(){return d},Nw:function(){return _},j2:function(){return m},Kd:function(){return v}});var r=e(91741);function o(t,n){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=function(t,n){if(!t)return;if("string"==typeof t)return u(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);"Object"===e&&t.constructor&&(e=t.constructor.name);if("Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return u(t,n)}(t))||n&&t&&"number"==typeof t.length){e&&(t=e);var r=0,o=function(){};return{s:o,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return a=t.done,t},e:function(t){c=!0,i=t},f:function(){try{a||null==e.return||e.return()}finally{if(c)throw i}}}}function u(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=new Array(n);e<n;e++)r[e]=t[e];return r}var i=function(t,n){return t.callWS({type:"recorder/list_statistic_ids",statistic_type:n})},a=function(t,n){return t.callWS({type:"recorder/get_statistics_metadata",statistic_ids:n})},c=function(t,n,e,r){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"hour",u=arguments.length>5?arguments[5]:void 0;return t.callWS({type:"recorder/statistics_during_period",start_time:n.toISOString(),end_time:null==e?void 0:e.toISOString(),statistic_ids:r,period:o,units:u})},s=function(t){return t.callWS({type:"recorder/validate_statistics"})},f=function(t,n,e){return t.callWS({type:"recorder/update_statistics_metadata",statistic_id:n,unit_of_measurement:e})},l=function(t,n,e,r){return t.callWS({type:"recorder/change_statistics_unit",statistic_id:n,old_unit_of_measurement:e,new_unit_of_measurement:r})},y=function(t,n){return t.callWS({type:"recorder/clear_statistics",statistic_ids:n})},p=function(t){if(!t||t.length<2)return null;var n=t[t.length-1].sum;if(null===n)return null;var e=t[0].sum;return null===e?n:n-e},d=function(t,n){var e,r=null,u=o(n);try{for(u.s();!(e=u.n()).done;){var i=e.value;if(i in t){var a=p(t[i]);null!==a&&(null===r?r=a:r+=a)}}}catch(c){u.e(c)}finally{u.f()}return r},_=function(t,n){return t.some((function(t){return null!==t[n]}))},m=function(t,n,e,r,o){return t.callWS({type:"recorder/adjust_sum_statistics",statistic_id:n,start_time:e,adjustment:r,display_unit:o})},v=function(t,n,e){var o=t.states[n];return o?(0,r.C)(o):(null==e?void 0:e.name)||n}}}]);